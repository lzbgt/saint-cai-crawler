function getQueryString(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(o);return null!=t?decodeURI(t[2]):null}function checkBrowserIsSport(){var e="",o=navigator.userAgent,t=o.indexOf("compatible")>-1&&o.indexOf("MSIE")>-1,a=o.indexOf("Edge")>-1&&!t,i=o.indexOf("Trident")>-1&&o.indexOf("rv:11.0")>-1;if(t){var n=new RegExp("MSIE (\\d+\\.\\d+);");n.test(o);var r=parseFloat(RegExp.$1);e=7==r?7:8==r?8:9==r?9:10==r?10:6}else e=a?12:i?11:-1;e>0&&e<9?($("#browserTipText").text("当前浏览器不支持，请切换到极速模式或者升级到最新版IE浏览器"),$("#browserTips").slideDown(200)):e>=9?($("#browserTipText").text("为获得更好的用户体验，请将浏览器切换到极速模式或者升级到最新版IE浏览器"),$("#browserTips").slideDown(200)):($("#browserTipText").text(""),$("#browserTips").hide())}function closeBrowserTips(){$("#browserTipText").text(""),$("#browserTips").hide()}function getRequest(e,o,t){$.post("/JsonDownload.ashx",{url:e},function(e){e&&o(e)},t||"json")}function postRequest(e,o,t){$.post("/PostHandle.ashx",{url:'{"postUrl":"'+e+'","postDataStr":"'+o+'"}'},function(e){e&&t(e)},"json")}function getDirectRequest(e,o){$.post(e,null,function(e){e&&o(e)},"json")}function toggleAnswer(e){$(e).hasClass("BtnShowAnsCon")?1==$(e).css("opacity")?($(e).css({opacity:0}),$(e).prev(".answer").removeClass("AnsConHide")):($(e).css({opacity:1}),$(e).prev(".answer").addClass("AnsConHide")):$(e).hasClass("answer")&&($(e).hasClass("AnsConHide")?($(e).removeClass("AnsConHide"),$(e).next(".BtnShowAnsCon").css({opacity:0})):($(e).addClass("AnsConHide"),$(e).next(".BtnShowAnsCon").css({opacity:1})))}function setAudioPlayer(){function e(){$audio[0].play(),audioInterval&&clearInterval(audioInterval),t()}function o(){$audio[0].pause(),audioInterval&&clearInterval(audioInterval)}function t(){var e=0;audioInterval=setInterval(function(){e=$audio[0].currentTime/$audio[0].duration*100,audioPlayer.find(".ProgressInnerBar").css("width",e+"%"),4!=$audio[0].readyState&&audioPlayer.find(".BtnControl").hasClass("Playing")?audioPlayer.find(".BtnControl").addClass("Waiting"):audioPlayer.find(".BtnControl").removeClass("Waiting");var o=timeFormat($audio[0].currentTime),t=timeFormat(a());audioPlayer.find(".Time").html(o+"/"+t),$audio[0].currentTime===$audio[0].duration&&(audioPlayer.find(".BtnControl").removeClass("Playing"),audioPlayer.find(".ProgressInnerBar").css("width","0%"),$audio[0].pause())},500)}function a(){return $audio[0].duration}function i(e){var o=e.pageX||e.originalEvent.targetTouches[0].pageX,a=audioPlayer.find(".ProgressBar").offset().left,i=(o-a)/audioPlayer.find(".ProgressBar").width()*100,n=Math.round(i);i<=0?(audioPlayer.find(".ProgressInnerBar").width("0%"),t(),$audio[0].currentTime=Math.round(n/100*$audio[0].duration)):i>0&&i<100?(audioPlayer.find(".ProgressInnerBar").width(i+"%"),t(),$audio[0].currentTime=Math.round(n/100*$audio[0].duration)):i>=100&&(audioPlayer.find(".ProgressInnerBar").width("100%"),t(),$audio[0].currentTime=Math.round(n/100*$audio[0].duration))}$audio=$("#audioEle"),audioPlayer=$(".M-Art-AudioPlayer2"),audioPlayer.find(".Time").html("00:00/00:00"),$audio.on("canplay",function(){audioPlayer.removeClass("M-Art-AudioPlayer2-Loading")}),audioPlayer.children(".BtnControl").on("click",function(){$(".Playing").removeClass("Waiting"),$(this).hasClass("Playing")?(o(),$(this).removeClass("Playing")):(e(),$(this).addClass("Playing"))}),audioPlayer.find(".Progress").on("click",function(e){i(e),e.stopPropagation(e)}),audioPlayer.find(".ProgressBar .ProgressPoint .StatusIco").mousedown(function(e){function o(){$(window).off("mousemove",i),$(window).off("mouseup",o)}i(e),e.stopPropagation(e),$(window).on("mousemove",i),$(window).on("mouseup",o)})}function updateDuration(e){$(e).on("canplay",function(){var o=$(this).get(0).duration,t=$(e).attr("data-id");$("#"+t).attr("data-audio-duration",o).text(timeFormatShort(o))})}function timeFormatShort(e){if(isNaN(e))return"音频不存在";var o=parseInt(e/60),t=parseInt(e%60);return(o>0?o+"分":"")+t+"秒"}function timeFormat(e){if(isNaN(e))return"00:00";var o=parseInt(e/60),t=parseInt(e%60);return o=o>=10?o:"0"+o,t=t>=10?t:"0"+t,o+":"+t}function dateFormat(e){var o="",t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),n=e.getHours(),r=e.getMinutes();return a=a<10?"0"+a:a,i=i<10?"0"+i:i,n=n<10?"0"+n:n,r=r<10?"0"+r:r,o=t+"-"+a+"-"+i+" "+n+":"+r,o}function playAudio(e){var o=$(e).attr("data-audio-src"),t=$(e).attr("data-audio-duration");initAudioPlayer(o,t),$(".audio-player-holder").removeClass("active"),$(e).addClass("active"),$(".audio-player-box").show(),$(".M-Art-AudioPlayer2 .BtnControl").hasClass("Playing")&&$(".M-Art-AudioPlayer2 .BtnControl").click();var a=$(e).offset().left,i=$(e).offset().top,n=$(".M-Art-AudioPlayer2 .BtnControl .StatusIco").offset().left,r=$(".M-Art-AudioPlayer2 .BtnControl .StatusIco").offset().top;$(".amtBall").length>0&&$(".amtBall").remove(),$("body").append($('<div class="amtBall" style="top:'+i+"px; left:"+a+'px"></div>')),$(".amtBall").fly({start:{left:a,top:i},end:{left:n,top:r,width:40,height:40},speed:1.5,vertex_Rtop:50,onEnd:function(){$(".amtBall").remove(),$(".M-Art-AudioPlayer2 .BtnControl").click()}})}function closeAudio(){$(".M-Art-AudioPlayer2 .BtnControl").removeClass("Playing"),$("#audioEle")[0].pause(),$("#audioEle").attr("src",""),$(".audio-player-box").hide(),$("#list .ScrollContent").css("padding-top",""),$(".audio-player-holder").removeClass("active")}function initAudioPlayer(e,o){$audio.attr({preload:"meta",src:e}),audioPlayer.find(".Time").html("00:00/"+timeFormat(10))}function getStyle(e){var o=null;return o=window.getComputedStyle?window.getComputedStyle(e,null):e.currentStyle,o}function showAbnormalTips(e){$("#J_prismPlayer .abnormal-tips").length>0?$("#J_prismPlayer .abnormal-tips").html('<div class="abnormal-tips-inner">'+e+"</div>"):$("#J_prismPlayer").append('<div class="abnormal-tips"><div class="abnormal-tips-inner">'+e+"</div></div>"),$("#dialogPlayer .action-tips").remove()}function h5PlayVideo(e){$("#dialogPlayer .buy-tips").hide(),$("#dialogPlayer .buy-main-tips").hide(),$("#dialogPlayer").removeClass("play-end");var o=($(window).width()-802)/2,t=($(window).height()-492)/2;$("#dialogPlayer").css({left:o,top:t}).show(),$("#dialogPlayer .action-tips").text("正在请求视频地址，请稍候...").show(),player&&player.dispose(),e?($("#dialogPlayer .action-tips").text("").hide(),playerConfig.source=e,player=new Aliplayer(playerConfig,function(e){e._switchLevel=0,$("#dialogPlayer video").attr("controlsList","nodownload");var o=sessionStorage.getItem("playermini");if(o){e.dispose();var t="视频禁止在小窗口播放，请关闭当前标签重新打开页面或重启浏览器继续播放。";showAbnormalTips(t)}}),player.on("ended",function(){player.fullscreenService.cancelFullScreen(),$("#dialogPlayer").addClass("play-end"),isShowBuyTips&&$(".buy-main-tips").show()}),player.on("play",function(){$("#dialogPlayer").removeClass("play-end"),isShowBuyTips&&$(".buy-main-tips").hide()}),player.on("timeupdate",function(){var e=$("#J_prismPlayer video").attr("id"),o=getStyle($("#J_prismPlayer")[0]);if(e&&e.indexOf("360")>-1&&"fixed"==o.position){player.dispose();var t="视频禁止在小窗口播放，请关闭当前标签重新打开网页或重启浏览器继续播放。";showAbnormalTips(t),sessionStorage.setItem("playermini",1)}}),player.on("pause",function(){$(".prism-player .prism-big-play-btn").show()}),$("#dialogPlayer video").bind("click",function(){"ready"==player.getStatus()||"playing"==player.getStatus()?player.pause():"pause"!=player.getStatus()&&"ended"!=player.getStatus()||player.play()}),player.on("error",function(e){var o=""+e.paramData.error_code,t="";switch(o){case"4001":t="参数不合理";break;case"4002":t="鉴权过期";break;case"4003":t="无效地址";break;case"4004":t="地址不存在";break;case"4005":t="开始下载数据错误，检测网络情况或播放地址是否可以访问";break;case"4006":t="开始下载元数据数据错误";break;case"4007":t="播放时错误";break;case"4008":t="加载超时，检测网络情况或播放地址是否可以访问";break;case"4009":t="请求数据错误，测网络情况或播放地址是否可以访问";break;case"4010":t="不支持加密视频播放";break;case"4011":t="播放格式不支持";break;case"4012":t="playauth解析错误";break;case"4013":t="播放数据解码错误，检测浏览器是否支持视频格式";break;case"4014":t="当前网络不可用，请检查网络情况";break;case"4015":t="获取数据过程被中止MEDIA_ERR_ABORTED";break;case"4016":t="网络错误，加载数据失败MEDIA_ERR_NETWORK";break;case"4017":t="返回的播放地址为空";break;case"4400":t="未知错误(由于服务器或网络原因不能加载资源，或者格式不支持)";break;case"4500":t="服务端请求错误，查看Network里点播服务的请求的具体错误";break;default:t="系统未知错误"}$(".prism-player .prism-ErrorMessage .prism-error-content").html("<p>"+t+"</p><p class='prism-error-opper'><a class='btn-error-clean' href='javascript:void(0)' onclick='closePlayer()'>关闭后重试</a></p>")})):$("#dialogPlayer .action-tips").text("视频地址无效，请刷新重试...")}function closePlayer(){player&&player.pause(),$("#dialogPlayer").hide()}function closeTips(){$(".buy-tips").hide()}function playVideo(e){var o=$(e).attr("data-video-src");""!=o?h5PlayVideo(o):alert("视频地址错误！")}function showNoteDetail(e){var o=window.event||arguments.callee.caller.arguments[0],t=$(e).attr("id").split("-")[1],a=o.pageX-5,i=o.pageY+5,n=$(e).attr("data-note-content");app._showNoteDetail(a,i,n,t)}function hideNoteDetail(){app._hideNoteDetail()}function showTextMenu(e){app._showTextMenu(e)}function formatScDate(timeStr){var time=eval("new "+timeStr.slice(1,-1)),timeFormateStr=time.getFullYear()+"-"+(1==(time.getMonth()+1).toString().length?"0"+(time.getMonth()+1).toString():time.getMonth()+1)+"-"+(1==time.getDate().toString().length?"0"+time.getDate().toString():time.getDate());return timeFormateStr}function openImgViewer(e){var o=$(e).attr("src")||$(e).attr("data-src");if(""!=o){readerWidth=$(".reader").width(),readerHeight=$(".reader").height();var t=$(e).attr("data-width")||$(e).width(),a=$(e).attr("data-height")||$(e).height(),i=t/a;t>=a?t>=.9*readerWidth&&(t=.9*readerWidth,a=t/i):a>=.9*readerHeight&&(a=.9*readerHeight,t=a*i);var n=(readerWidth-t)/2,r=(readerHeight-a)/2;app._openImgViewer(o,n,r,t,a)}}function guid(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function creatMark(e){$("#markCanvas").length>0&&$("#markCanvas").remove(),$("body").append('<canvas id="markCanvas" width="300" height="300" style="position: fixed; left: -999999em; top: -999999em; z-index:1"></canvas>');var o=window.devicePixelRatio||1,t=document.getElementById("markCanvas"),a=t.getContext("2d");if(!a)return"";var i=t.getBoundingClientRect();t.width=Math.floor(i.width*o),t.height=Math.floor(i.height*o),a.scale(o,o),a.font="bold 40px 'Times New Roman'",a.textAlgin="center",a.textBaseline="middle",a.fillStyle="rgba(0,0,0,0.04)";var n=a.measureText(e).width;console.log(n),a.translate(t.width/2,t.width/2),a.rotate(-30*Math.PI/180),a.fillText(e,-n/2,-20);var r=t.toDataURL("image/png");return r}function wpsGetUserVipInfo(e){if(null!=wpsUserInfo)return console.log("wpsGetUserVipInfo[已存在]",wpsUserInfo),void(e&&e(wpsUserInfo));try{wpsClientApi.getUserVipInfo(function(o){wpsUserInfo=o.userId?o:null,console.log("wpsGetUserVipInfo[API获取]",wpsUserInfo),e&&e(wpsUserInfo)})}catch(o){console.log("wpsGetUserVipInfo",o),e&&e(null)}}function getNowFullTime(){var e=null,o=new Date,t=o.getFullYear(),a=o.getMonth()+1,i=o.getDay(),n=o.getHours(),r=o.getMinutes(),s=o.getSeconds();i=i>9?i:"0"+i,a=a>9?a:"0"+a,n=n>9?n:"0"+n,r=r>9?r:"0"+r,s=s>9?s:"0"+s;var l=t+"-"+a+"-"+i+" "+n+":"+r+":"+s;return e={fullDateTime:l,dateObj:o,ms:Date.parse(o)},e}function dataCollect(e,o,t){isWps?(t.entry_id="",t.func="docer_tiku",t.first_entry="",e&&"ok"==e.callstatus?t.member_identity=e.isDocerMember?1:e.isSuperMember?2:"1"==$("#hiddenUserIsVip").val()?3:-1:t.member_identity=0,wpsClientApi.getEntrance().then(function(e){console.log("getEntrance页面收到返回：",e),e&&e.state&&(t.first_entry=e.state),console.info("【wps埋点："+o+"】",t),wpsClientApi.collectInfo(o,t)}).catch(function(){console.info("【wps埋点："+o+"】",t),wpsClientApi.collectInfo(o,t)})):callback&&callback()}function readWord(e){var o=[],t=$.trim($(e).attr("data-word"));if(""!=t){var a=$("#hiddenLanguage").val()||"";if(""==a)return;a=a.toLocaleLowerCase();var i="";if(o.length>0&&o.indexOf(a)>=0){var n={speed:5,person:0,intonation:5,volume:5,token:getReadWordToken()};i="https://tsn.baidu.com/text2audio?",i+="tex="+t,i+="&lan=zh",i+="&tok="+n.token,i+="&ctp=1",i+="&cuid="+Date.now(),i+="&spd="+n.speed,i+="&pit="+n.intonation,i+="&vol="+n.volume,i+="&per="+n.person}else i="https://dict.youdao.com/dictvoice?audio="+t+"&le="+a;var r=$("#wordAudio");r.length>0&&r.remove(),$("body").append('<audio id="wordAudio" src="'+i+'" preload="metadata" controls="controls"></audio>'),$(".WordAudioPlaying").removeClass("WordAudioPlaying"),r=$("#wordAudio"),r[0].addEventListener("ended",function(){$(e).removeClass("WordAudioPlaying")});try{$(e).addClass("WordAudioPlaying"),r[0].play()}catch(o){$(e).removeClass("WordAudioPlaying")}}}var bookId=getQueryString("id")||"",chapId=getQueryString("chapId")||"",pId=getQueryString("pId")||"",scReaderVision="0.0.0",saveReadeRecordInterval=null,hostUrl=document.getElementById("hiddenHostUrl").value||"",isHideCover="True"==document.getElementById("hiddenIsHideCover").value,isHideIntro="True"==document.getElementById("hiddenIsHideIntro").value,userAIToken=document.getElementById("hiddenUserAIToken")?document.getElementById("hiddenUserAIToken").value:"",aiAccessToken=document.getElementById("hiddenAIAccessToken")?document.getElementById("hiddenAIAccessToken").value:"",packageId=getQueryString("packageId")||getQueryString("fatherID")||"",isZxxProduct=document.getElementById("hiddenBookIsZxxProduct")&&"true"==document.getElementById("hiddenBookIsZxxProduct").value.toLowerCase();""!=packageId&&null!=packageId&&(isZxxProduct=document.getElementById("hiddenPackageIsZxxProduct")&&"true"==document.getElementById("hiddenPackageIsZxxProduct").value.toLowerCase());var apiHost={e:"https://e.100xuexi.com",app:"https://app.100xuexi.com",user:"https://user.100xuexi.com",wx:"https://wx.100xuexi.com",eshu:"https://eshu."+hostUrl},wpsPageName="preview_detail",isWps=!!window.cefQuery,wpsHost="https://wpspcminprograme.100xuexi.com";(function(e){e.alerts={alert:function(o,t,a,i){null==o&&(o="Alert"),e.alerts._show(o,t,null,"alert",function(e){a&&a(e)},i)},confirm:function(o,t,a,i,n){null==o&&(o="Confirm"),e.alerts._show(o,t,null,"confirm",function(e){a&&a(e)},i,n)},_show:function(o,t,a,i,n,r,s){var l="";switch(l+='<div class="msg-box-mask">',l+="</div>",l+='  <div class="msg-box">',""!=o&&(l+='    <div class="msg-title">',l+='      <div class="msg-title-text"> ',l+=o,l+="      </div>",l+="    </div>"),t&&(l+='    <div class="msg-con"> ',l+=t,l+="    </div>"),l+='    <div class="msg-foot">',"alert"==i&&(l+='      <ul class="aler-btns">',l+=r?'        <li><a href="javascript:void(0)" class="btn-ok">'+r+"</a></li>":'        <li><a href="javascript:void(0)" class="btn-ok">确定</a></li>',l+="      </ul>"),"confirm"==i&&(l+='      <ul class="confirm-btns">',l+=r?'        <li><a href="javascript:void(0)" class="btn-no">'+r+"</a></li>":'        <li><a href="javascript:void(0)" class="btn-no">取消</a></li>',l+=s?'        <li><a href="javascript:void(0)" class="btn-ok">'+s+"</a></li>":'        <li><a href="javascript:void(0)" class="btn-ok">确定</a></li>',l+="      </ul>"),l+="    </div>",l+="  </div>",e("body").append(l),i){case"alert":e(".btn-ok").click(function(){e.alerts._hide(),n&&n(!0)});break;case"confirm":e(".btn-ok").click(function(){e.alerts._hide(),n&&n(!0)}),e(".btn-no").click(function(){e.alerts._hide(),n&&n(!1)})}},_hide:function(){e(".msg-box-mask").remove(),e(".msg-box").remove()}},scAlert=function(o,t,a,i){e.alerts.alert(o,t,a,i)},scConfirm=function(o,t,a,i,n){e.alerts.confirm(o,t,a,i,n)}})(jQuery);var $audio=null,audioPlayer=null,audioInterval=null,player=null,isShowBuyTips=!0,playerConfig={id:"J_prismPlayer",source:"",width:"100%",height:"100%",autoplay:!0,isLive:!1,rePlay:!1,playsinline:!0,preload:!0,useH5Prism:!0,cover:"",skinLayout:[{name:"bigPlayButton",align:"cc"},{name:"H5Loading",align:"cc"},{name:"errorDisplay",align:"tlabs",x:0,y:0},{name:"infoDisplay"},{name:"tooltip",align:"blabs",x:0,y:56},{name:"thumbnail"},{name:"controlBar",align:"blabs",x:0,y:0,children:[{name:"progress",align:"blabs",x:0,y:44},{name:"playButton",align:"tl",x:15,y:12},{name:"timeDisplay",align:"tl",x:10,y:7},{name:"fullScreenButton",align:"tr",x:10,y:12},{name:"setting",align:"tr",x:15,y:12},{name:"volume",align:"tr",x:5,y:10}]}]},aiChatLoaindingHtml='<div class="HolderArea">\n    <div class="Tips">\n        <div class="TipsIcon"><i class="bi bi-exclamation-triangle-fill"></i></div>\n        <div class="TipsText">正在加载，请稍候...</div>\n    <div>\n<div>',aiChatError='<div class="HolderArea">\n    <div class="Tips">\n        <div class="TipsIcon"><i class="bi bi-exclamation-triangle-fill"></i></div>\n        <div class="TipsText">加载失败，请重试</div>\n    <div>\n<div>';$(function(){checkBrowserIsSport(),$("#dialogPlayer").draggable({handle:".dialog-player-title",containment:"body",scroll:!1}),$("#dialogPlayer").resizable({aspectRatio:16/9,minWidth:400,maxWidth:960}),setAudioPlayer()}),Date.prototype.format=function(e){var o={"(y+)":this.getFullYear(),"(M+)":this.getMonth()+1,"(d+)":this.getDate(),"(h+)":this.getHours(),"(m+)":this.getMinutes(),"(s+)":this.getSeconds()};for(var t in o)new RegExp(t).test(e)&&(e=e.replace(RegExp.$1,2==RegExp.$1.length?("0"+o[t]).slice(-2):o[t]));return e};var readerWidth=0,readerHeight=0,scrollTimer=null,toastTimer=null,getChapTimmer=null,getEbookCatalogTimmer=null,wpsUserInfo=null,getReadWordToken=function(){var e="";return $.ajax({type:"GET",url:"/JsonDownload.ashx",data:{url:apiHost.wx+"/handle/ThirdOpened.ashx?method=GetBaiduAudioToken"},async:!1,dataType:"json",success:function(o){o.access_token&&(e=o.access_token)},error:function(e){}}),e},startLoadTimeObj=getNowFullTime(),preKlm=getQueryString("preKlm")||"";isWps&&(window.wpsClientApi.setWindowCallBack("notifyJs",function(e){console.log("支付结果监听",e),"channelVipStateChange"===e.eventName&&(localStorage.setItem("WPS_PAY_RESULT",JSON.stringify(e)),window.location.replace(wpsHost+"/updateUserLoginStatus.ashx?method=updateVipStatusAndSkip&userId="+$("#hiddenUserId").val()+"&mobile="+$("#hiddenUserMobile").val()+"&retUrl="+encodeURIComponent(wpsHost+"/product/skipToRead.aspx?id="+(packageId||bookId)+"&platnum=1")))}),wpsClientApi.checkLoginState().then(function(e){console.log("checkLoginState",e),e&&e.isLogined||(packageId?window.location.replace(wpsHost+"/ebook/"+packageId+".html"):bookId?window.location.replace(wpsHost+"/ebook/"+bookId+".html"):window.location.replace(wpsHost))}),wpsClientApi.registerLogout(function(e){e&&"ok"==e.callstatus&&window.location.replace(wpsHost+"/updateUserLoginStatus.ashx?method=logout&retUrl="+encodeURIComponent(wpsHost))}));var app=new Vue({el:"#reader",components:{"error-correction-list":errorCorrectionList,"sc-confirm-and-alert":scConfirmAndAlert},data:{isZxxProduct:isZxxProduct,mainLoadingTips:"正在拼命加载...",bookId:bookId,chapId:chapId,pId:pId,packageId:packageId,isZhenti:"true"==document.getElementById("hiddenIsZhentihuibian").value.toLowerCase(),user:null,userInfoLoading:!1,ebook:null,ebookLoading:!1,catalogLoading:!1,noteList:[],noteListPageIndex:0,noteListPageSize:5,noteListLoadLock:!1,noteListHasMore:!0,noteListCount:0,noteListHasLoad:!1,isShowNoteDetail:!1,noteDetail:{noteDetailId:"",noteDetailText:"",noteDetailStyle:null},isShowAddnote:!1,isShowTextMenu:!1,textMenuStyle:{},noteObjForHandle:{type:"",eBookNoteColorNo:0,content:"",images:"",cutOut:"",chapterStartPos:0,chapterEndPos:0,paragraphStartPos:0,paragraphEndPos:0,wordStartPos:0,wordEndPos:0},noteColorList:[{colorNo:0,colorText:"红色",colorValue:"#f99595"},{colorNo:2,colorText:"绿色",colorValue:"#83ceaf"},{colorNo:3,colorText:"蓝色",colorValue:"#3ea6ff"},{colorNo:4,colorText:"紫色",colorValue:"#d89bfe"}],chapNoteList:[],isSubmittingData:!1,bookmarkList:[],currentBookMark:null,bookmarkIsLight:!1,isShowCatalog:!1,isShowCode:!1,isShowFeedback:!1,isShowHelp:!1,isShowSet:!1,isShowNote:!1,isShowBookmark:!1,isShowSearch:!1,isShowWrong:!1,isShowUnseal:!1,detailLink:"",buyLink:"",buyVipLink:"",detailCodeSrc:"",loginLink:"",myEBookPurchaseLink:"",bgColorList:[{id:1,text:"珍珠白",value:"#ffffff"},{id:2,text:"杏仁黄",value:"#f9f3eb"},{id:3,text:"豆沙绿",value:"#c9e9ca"},{id:4,text:"极光灰",value:"#cfd6ea"}],fontSizeList:[{id:1,text:"14号",value:"48.6%",showValue:"14px"},{id:2,text:"16号",value:"55.6%",showValue:"16px"},{id:3,text:"18号",value:"62.5%",showValue:"18px"},{id:4,text:"20号",value:"69.4%",showValue:"20px"},{id:5,text:"22号",value:"76.4%",showValue:"22px"},{id:6,text:"24号",value:"83.3%",showValue:"24px"},{id:7,text:"28号",value:"97.2%",showValue:"28px"},{id:8,text:"32号",value:"111.1%",showValue:"32px"},{id:9,text:"36号",value:"125%",showValue:"36px"}],fontFamilyList:[{id:1,text:"默认字体",value:""},{id:2,text:"微软雅黑",value:"Microsoft Yahei"},{id:3,text:"黑体",value:"SimHei"},{id:4,text:"宋体",value:"SimSun"},{id:5,text:"楷体",value:"KaiTi"},{id:6,text:"仿宋",value:"FangSong"}],bgImgList:[{id:0,text:"默认",value:"random-bg-0"},{id:1,text:"高山峡谷",value:"random-bg-1"},{id:2,text:"爱情海滨",value:"random-bg-2"},{id:3,text:"希望的田野",value:"random-bg-3"},{id:4,text:"落日余晖",value:"random-bg-4"},{id:5,text:"瀑布高悬",value:"random-bg-5"},{id:6,text:"水天一色",value:"random-bg-6"},{id:7,text:"瀑布",value:"random-bg-7"},{id:8,text:"炫彩极光",value:"random-bg-8"},{id:9,text:"湖上泛舟",value:"random-bg-9"}],uiConfig:{fontSize:"62.5%",fontFamily:"",backgroundColor:"#ffffff",backgroundClass:"random-bg-0",needUploadImg:1,shortcutKey:1,isShowAIChatBtn:!0},currentCatalog:null,toastHtml:"",isCanRead:!1,isCanNote:!0,feedContent:"",userContactWay:"",feedImgList:[],feedLoadLock:!1,searchResultList:[],searchKey:"",lastLoadChapIndex:0,isLoadingChap:!1,viewCatalog:null,readRecord:null,shengcaidianzishuInstallUrl:apiHost.eshu+"/DeskTopH5/SignTool/Install.exe",readStartTime:(new Date).format("yyyy-MM-dd hh:mm:ss"),isLibrary:!!(1==getQueryString("isLibrary")||getQueryString("From")&&"lib.100xuexi.com"==getQueryString("From").toLocaleLowerCase()),isLibraryUser:!1,readRate:0,isShowImgViewer:!1,imgViewerSrc:"",imgViewerStyle:{left:0,top:0,width:0,height:0},agentName:getQueryString("GroupUserName")||"",isApiPartner:!!getQueryString("GroupUserName")&&("mbalib.100xuexi.com"==getQueryString("GroupUserName").toLowerCase()||"mooc.100xuexi.com"==getQueryString("GroupUserName").toLowerCase()),isCol:!!getQueryString("From")&&("col.100xuexi.com"==getQueryString("From").toLocaleLowerCase()||"col.sc.edu.chineseall.com"==getQueryString("From").toLocaleLowerCase()),unsealObj:{imgCodeSrc:"",imgCode:"",password:""},equipmentId:"pch5-"+guid(),readerSign:"",maskLoading:!1,bgText:"",extendsAd:null,isShowExtendsAd:!0,isHideCover:isHideCover,isHideIntro:isHideIntro,readerContentBgCss:"",readerContentBgStyle:null,isWpsMiniprogram:isWps,isShowAIChat:"1"==localStorage.getItem("EBOOK_ISSHOW_AICHAT"),isCanUseAIChat:!isWps,scAgentApp:""},methods:{_getReaderUIConfig:function(){var e=this,o=localStorage.getItem("scReaderConfig_v"+scReaderVision)||"";""!=o&&(o=JSON.parse(o),e.uiConfig=o),""==e.uiConfig.backgroundClass&&(e.uiConfig.backgroundClass="random-bg-0"),null==e.uiConfig.needUploadImg&&(e.uiConfig.needUploadImg=1),null==e.uiConfig.shortcutKey&&(e.uiConfig.shortcutKey=1),null==e.uiConfig.isShowAIChatBtn&&(e.uiConfig.isShowAIChatBtn=!0),$("html").css("fontSize",e.uiConfig.fontSize)},_setLink:function(){var e=this,o=e.packageId||e.bookId;""!=e.agentName?(e.detailLink="https://"+e.agentName+"/Ebook/"+o+".html",e.buyLink="https://"+e.agentName+"/Ebook/"+o+".html",e.loginLink="https://"+e.agentName,e.myEBookPurchaseLink="https://"+e.agentName+"/UserCenter/PaperBuyEBookTK.aspx",e.loginOutLink="https://"+e.agentName+"/UserCenter/LoginOut.aspx",e.isZxxProduct?e.buyVipLink="https://"+e.agentName+"/k12vip/Index.aspx":e.buyVipLink="https://"+e.agentName+"/vip/Index.aspx",e.rechargeAiAccountLink="https://"+e.agentName+"/UserCenter/UserAIMoney.aspx"):(e.detailLink=apiHost.e+"/Ebook/"+o+".html",e.buyLink=apiHost.e+"/Ebook/"+o+".html",e.loginLink=apiHost.user+"/login.aspx?RetUrl="+encodeURIComponent(window.location.href),e.myEBookPurchaseLink=apiHost.user+"/MyDeal/myEBookPurchase.aspx",e.loginOutLink=apiHost.user+"/Login/LoginOut.aspx",e.isZxxProduct?e.buyVipLink="https://www.100xuexi.com/topic/k12vip.html":e.buyVipLink="https://www.100xuexi.com/topic/vip.html",e.rechargeAiAccountLink="https://user.100xuexi.com/MyAccount/myAIMoney.aspx")},_getUserInfo:function(e){var o=this;o.userInfoLoading=!0,o.user={userID:$("#hiddenUserId").val(),nickName:$("#hiddenUserNickName").val(),headPic:$("#hiddenUserHeadPic").val(),eBookUID:"",mobile:$("#hiddenUserMobile").val()},o.userInfoLoading=!1,e&&e()},_getEbookInfo:function(e){var o=this;o.ebookLoading=!0,o.mainLoadingTips="正在获取电子书信息...",o.ebook={bookId:$("#hiddenBookId").val(),name:$("#hiddenBookName").val(),isPackage:$("#hiddenBookIsPackage").val(),makeTool:$("#hiddenBookMakeTool").val(),pic:$("#hiddenBookPic").val(),guid:$("#hiddenBookPath").val(),isXiaJia:$("#hiddenBookIsXiaJia").val(),user:$("#hiddenBookUser").val(),viewRight:$("#hiddenBookViewRight").val(),isVip:$("#hiddenBookIsVip").val(),isZxxVip:$("#hiddenBookIsZxxVip").val(),catalog:null,catalogVersion:$("#hiddenBookVersion").val()},o.isWpsMiniprogram?(document.title="考研考证题库",$icon=document.querySelector('link[rel="icon"]'),null!=$icon?$icon.href="/wpsprogram.ico":($icon=document.createElement("link"),$icon.rel="icon",$icon.href="/wpsprogram.ico",document.head.appendChild($icon))):document.title=o.ebook.name,o._getIsBuy(function(){if(1==o.ebook.isXiaJia&&!o.isCanRead&&!o.isCol)return alert("该产品已下架"),""!=o.agentName?window.location.replace("https://"+o.agentName+"/Ebook/"+o.bookId+".html"):o.isApiPartner?(window.opener=null,window.open("","_self"),window.close()):window.location.replace(apiHost.e+"/Ebook/"+o.bookId+".html"),!1;e&&e(),o.ebookLoading=!1})},_getPackageInfo:function(e){var o=this;o.packageId&&0!=o.packageId&&$("#hiddenPackageUser").length>0&&("Y"==$("#hiddenPackageUser").val()||o.isZxxProduct&&1==$("#hiddenPackageIsZxxVip").val()||!o.isZxxProduct&&1==$("#hiddenPackageIsVip").val()||0==$("#hiddenPackagePrice").val()||"free"==$("#hiddenPackageViewRight").val())&&(o.isCanRead=!0,isShowBuyTips=!o.isCanRead),e&&e()},_getIsBuy:function(e){var o=this;o.isLibrary?(o.isCanNote=!1,"1"==$("#hiddenIsLibraryUser").val()?(o.isCanRead=!0,isShowBuyTips=!o.isCanRead,o.isLibraryUser=!0):"true"==$("#hiddenIsBuy").val()&&(o.isCanRead=!0,isShowBuyTips=!o.isCanRead),e&&e()):o.packageId&&0!=o.packageId?o._getPackageInfo(function(){e&&e()}):(o.isCanRead="Y"==o.ebook.user||o.isZxxProduct&&1==o.ebook.isZxxVip||!o.isZxxProduct&&1==o.ebook.isVip||0==o.ebook.price||"free"==o.ebook.viewRight,isShowBuyTips=!o.isCanRead,e&&e())},_getEbookCatalog:function(e){var o=this;o.catalogLoading=!0,o.mainLoadingTips="正在获取电子书目录...";var t=$("#hiddenNcxStatus").val(),a=$("#hiddenNcxStr").html(),i=$("#hiddenNcxErrMsg").val(),n=$("#hiddenNcxBlockState").val();if(1==t){a="<ncx>"+a+"</ncx>";var r=a;$(r).find("navPoint")||(r=$.parseXML(a));var s=$(r).find("navPoint").length-1,l="";l=o.isHideCover?'<div class="cover-inner"><p id="coverP"><img class="cover-img" src="https://eshu.100xuexi.com/ChangePicSize.ashx?width=800&height=800&src=PureCover/Ebook/'+o.bookId+'.jpg" /><span class="cover-title">'+o.ebook.name+"</span></p></div>":'<div class="cover-inner"><p id="coverP"><img class="cover-img" src="'+o.ebook.pic+'" /><span class="cover-title">'+o.ebook.name+"</span></p></div>",o.ebook.catalog=[{chapEleId:"chapEle0",chapId:"cover",navTitle:"封面",navLink:"",isFree:!0,isFreePoint:!1,level:"1",levelClass:"level-1",parentNode:[],pageIndex:0,content:l,hasLoadedContent:!0,chapPosIndex:0,isCanShow:!0}];var d="",c="",p="1",g=!1;$(r).find("navPoint").each(function(e,t){d=$(t).find("text").text()||"",c=$(t).find("content").attr("src")||"",u=!0,p=$(t).attr("level")||"1",g="true"==$(t).find("content").attr("isFreePoint"),d.length>0&&c.length>0&&!/目\s+录/i.test(d)&&o.ebook.catalog.push({chapId:c.replace(".html",""),navTitle:d,navLink:c,isFree:!0,isFreePoint:g,level:p,levelClass:"level-"+p,parentNode:[],hasLoadedContent:!1,isCanShow:!(o.isHideIntro&&/内容简介/i.test(d))})});for(var u=!0,h=0;h<o.ebook.catalog.length;h++)o.isCanRead?u=!0:(o.ebook.catalog[h].isFreePoint&&(s=h,u=!0),h>s&&(u=!1)),o.ebook.catalog[h].isFree=u;o.ebook.freeIndex=o.ebook.catalog.length-1;for(h=0;h<o.ebook.catalog.length;h++){o.ebook.catalog[h].chapEleId="chapEle"+h,o.ebook.catalog[h].pageIndex=h,o.ebook.catalog[h].parentNode=o._getParentCatalog(o.ebook.catalog[h]),o.ebook.catalog[h].isFree&&(o.ebook.freeIndex=h);var m=h;for(k=h+1;k<o.ebook.catalog.length&&h+1<o.ebook.catalog.length;k++)o.ebook.catalog[h].chapId==o.ebook.catalog[k].chapId&&(m=k);o.ebook.catalog[h].maxPageIndexWithSameChapId=m}var f=0;for(h=1;h<o.ebook.catalog.length;h++){for(var v=!1,k=0;k<h;k++)if(o.ebook.catalog[h].chapId==o.ebook.catalog[k].chapId){o.ebook.catalog[h].chapPosIndex=o.ebook.catalog[k].chapPosIndex,v=!0;break}v||(o.ebook.catalog[h].chapPosIndex=f+1,f++)}if(""!=chapId&&null!=chapId){var w=!1;for(h=0;h<o.ebook.catalog.length;h++)if(chapId==o.ebook.catalog[h].chapId){o.viewCatalog=o.ebook.catalog[h],o.currentCatalog=o.ebook.catalog[h],w=!0;break}w||(o.toast("章节不存在"),o.viewCatalog=o.ebook.catalog[0],o.currentCatalog=o.ebook.catalog[0],o.isCanUseAIChat=!1)}else o.viewCatalog=o.ebook.catalog[0],o.currentCatalog=o.ebook.catalog[0],o.isCanUseAIChat=!1;o.catalogLoading=!1,setTimeout(function(){e&&e()},1e3)}else-1==t?(alert(i),o.catalogLoading=!1):-3==t?getEbookCatalogTimmer=setTimeout(function(){o._getEbookCatalog(e)},1e3):-4==t?(1==n?o.toggleUnseal():2==n?o.$refs.scConfirm.show('<div class="com-popdialog-tips">'+i+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:"close"}):3==n?o.$refs.scConfirm.show('<div class="com-popdialog-tips">'+i+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:"close"}):4==n?o.$refs.scConfirm.show('<div class="com-popdialog-tips"><div class="error-tips">'+i+'</div><div class="qr-code"><img src="https://service.100eshu.com/app/BookService.ashx?method=Get2DUrl&url=https://e.100xuexi.com/DigitalLibrary/CertificationSkip.html" /></div><div class="qr-code-des">使用圣才电子书APP扫码进行实名认证</div></div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:"close"}):5==n?o.$refs.scConfirm.show('<div class="com-popdialog-tips"><div class="error-tips">'+i+'</div><div class="qr-code"><img src="https://g.100xuexi.com/CssModel/comBlock/comPic/appDownloadCode.png" /></div><div class="qr-code-des">扫码下载圣才电子书APP</div></div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:"close"}):o.$refs.scConfirm.show('<div class="com-popdialog-tips">'+i+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:"close"}),o.catalogLoading=!1):(o.catalogLoading=!1,o.$refs.scConfirm.show('<div class="com-popdialog-tips">'+i+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:"close"}))},_getParentCatalog:function(e){for(var o=this,t=o.ebook.catalog,a=e.level,i=[],n=0,r=0;r<t.length;r++)e.chapEleId==t[r].chapEleId&&(n=r);for(r=n;r>0&&a>1;r--)t[r].level<a&&(i.push(t[r]),a--);return i},_getChap:function(e,o,t,a){var i=this;if(!i.isLoadingChap)if(i.checkIsCanRead(e)){if(i.isLoadingChap=!0,i._setStudyHistroy(),i.readStartTime=(new Date).format("yyyy-MM-dd hh:mm:ss"),i._checkIsFirstChap(e,o)){var n=getChapCore(apiHost.eshu,i.uiConfig.backgroundColor,i.isCanNote);if(1==n.chapStatus){for(var r=0;r<i.ebook.catalog.length;r++)if(e==i.ebook.catalog[r].chapEleId){i.ebook.catalog[r].content=n.chapStr,i.ebook.catalog[r].hasLoadedContent=!0,Vue.set(i.ebook.catalog,r,i.ebook.catalog[r]),i.lastLoadChapIndex=r,i.viewCatalog=i.ebook.catalog[r],$("#readerContent").animate({scrollTop:0},0),i.readRate=(i.viewCatalog.pageIndex+1)/i.ebook.catalog.length*100;break}}else-1==n.chapStatus?i.$refs.scConfirm.show('<div class="com-popdialog-tips">'+chapErrMsg+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""}):-2==n.chapStatus?getChapTimmer=setTimeout(function(){i.$refs.scConfirm.show('<div class="com-popdialog-tips">'+n.chapErrMsg+"</div>",{
popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""})},1e3):-3==n.chapStatus?getChapTimmer=setTimeout(function(){},1e3):-4==n.chapStatus?1==n.chapBlockState?i.toggleUnseal():2==n.chapBlockState?i.$refs.scConfirm.show('<div class="com-popdialog-tips">'+n.chapErrMsg+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""}):3==n.chapBlockState?i.$refs.scConfirm.show('<div class="com-popdialog-tips">'+n.chapErrMsg+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""}):4==n.chapBlockState?i.$refs.scConfirm.show('<div class="com-popdialog-tips"><div class="error-tips">'+n.chapErrMsg+'</div><div class="qr-code"><img src="https://service.100eshu.com/app/BookService.ashx?method=Get2DUrl&url=https://e.100xuexi.com/DigitalLibrary/CertificationSkip.html" /></div><div class="qr-code-des">使用圣才电子书APP扫码进行实名认证</div></div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:"close"}):5==n.chapBlockState?i.$refs.scConfirm.show('<div class="com-popdialog-tips"><div class="error-tips">'+n.chapErrMsg+'</div><div class="qr-code"><img src="https://g.100xuexi.com/CssModel/comBlock/comPic/appDownloadCode.png" /></div><div class="qr-code-des">扫码下载圣才电子书APP</div></div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:"close"}):i.$refs.scConfirm.show('<div class="com-popdialog-tips">'+n.chapErrMsg+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""}):i.$refs.scConfirm.show('<div class="com-popdialog-tips">'+n.chapErrMsg+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""});i.isLoadingChap=!1,i.$nextTick(function(){var o=i._getChapPosIndexByChapEleId(e)-1;i._getNoteByChap(o,function(){a&&setTimeout(function(){a()},1e3)})})}else for(r=0;r<i.ebook.catalog.length;r++)if(e==i.ebook.catalog[r].chapEleId){i.ebook.catalog[r].content="",i.ebook.catalog[r].hasLoadedContent=!0,Vue.set(i.ebook.catalog,r,i.ebook.catalog[r]),i.lastLoadChapIndex=r,i.isLoadingChap=!1,"up"==t?i._getPrevChap():i._getNextChap();break}}else if(i.isCol)i.$refs.scConfirm.show('<div class="com-popdialog-tips">暂无阅读权限<br/>阅读完整内容请联系我们<br/>（电话：4009622585）</div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""});else if(i.isLibrary)i.isLibraryUser?i.$refs.scConfirm.show('<div class="com-popdialog-tips">暂无阅读权限</div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""}):i.$refs.scConfirm.show('<div class="com-popdialog-tips">非授权用户，暂无阅读权限</div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""});else if(i.isWpsMiniprogram){var s='<div class="com-popdialog-tips">试读已结束<br/>开通题库权益后可阅读完整内容</div>';i.$refs.scConfirm.show(s,{popDialogTitle:"温馨提示",cancelText:"取消",confirmText:"开通题库权益",type:"confirm",data:"gotobuy",popDialogClass:"wps-popdialog-box"}),wpsGetUserVipInfo(function(e){dataCollect(e,"docer_tiku_display",{page_name:"preview_detail",page_position:"",module_name:"pay_box",module_position:"",element_name:"",element_position:"",element_type:"module",event_time:getNowFullTime().fullDateTime,resource_id:i.bookId,resource_type:"book",file_type:"",pre_klm:preKlm}),dataCollect(e,"docer_tiku_display",{page_name:"preview_detail",page_position:"",module_name:"pay_box",module_position:"",element_name:"vip_btn",element_position:"",element_type:"button",event_time:getNowFullTime().fullDateTime,resource_id:i.bookId,resource_type:"book",file_type:"",pre_klm:preKlm})})}else{s='<div class="com-popdialog-tips">您尚未购买<br/>购买后可阅读完整内容</div>';i.isZxxProduct||0!=$("#hiddenVipBuyPrice").val()||1!=$("#hiddenIsShowBuyVip").val()?i.isZxxProduct&&0==$("#hiddenVipZxxBuyPrice").val()&&1==$("#hiddenIsShowBuyVip").val()&&(s='<div class="com-popdialog-tips">您尚开通中小学VIP会员（KVIP）<br/>开通KVIP后可阅读完整内容</div>',i.$refs.scConfirm.show(s,{popDialogTitle:"温馨提示",cancelText:"取消",confirmText:"开通KVIP",type:"confirm",data:"gotobuyvip"})):(s='<div class="com-popdialog-tips">您尚未购买<br/>购买或开通VIP会员后可阅读完整内容</div>',i.$refs.scConfirm.show(s,{popDialogTitle:"温馨提示",cancelText:"取消",confirmText:"立即购买",type:"confirm",data:"gotobuy"}))}},_getChapPosIndexByChapEleId:function(e){for(var o=this,t=0,a=0;a<o.ebook.catalog.length;a++)if(e==o.ebook.catalog[a].chapEleId){t=o.ebook.catalog[a].chapPosIndex;break}return t},_checkIsHasContent:function(e){for(var o=this,t=!1,a=0;a<o.ebook.catalog.length;a++)if(e==o.ebook.catalog[a].chapEleId&&o.ebook.catalog[a].hasLoadedContent){t=!0;break}return t},_getNextChap:function(){var e=this;e.lastLoadChapIndex<e.ebook.catalog.length-1&&e._getChap(e.ebook.catalog[e.lastLoadChapIndex+1].chapEleId,e.ebook.catalog[e.lastLoadChapIndex+1].chapId,"down")},_getPrevChap:function(){var e=this;e.lastLoadChapIndex>0&&e._getChap(e.ebook.catalog[e.lastLoadChapIndex-1].chapEleId,e.ebook.catalog[e.lastLoadChapIndex-1].chapId,"up")},_getNoteByChap:function(e,o){var t=this;if(t.user&&10009!=t.user.userID){t.chapNoteList=[];var a=apiHost.app+"/app/TalkHandler/TalkEBookPage.ashx?method=GetEBookNoteList";a+="&userID="+t.user.userID,a+="&eBookId="+t.bookId,a+="&chapterStartPos="+e,a+="&chapterEndPos="+e,a+="&noCache=1",a+="&pageIndex=0",a+="&pageSize=10000",getRequest(a,function(e){if(e&&e.talks)for(var a=0;a<e.talks.length;a++)e.talks[a].colorNo=e.talks[a].eBookNoteColorNo,t._findNote(e.talks[a]),t._lightNoteInBook(e.talks[a]),t.chapNoteList.push(e.talks[a]);o&&o()})}else o&&o()},_checkIsFirstChap:function(e,o){for(var t=this,a=!0,i=[],n=0;n<t.ebook.catalog.length;n++)t.ebook.catalog[n].chapId==o&&i.push(t.ebook.catalog[n].chapEleId);return i.indexOf(e)>0&&(a=!1),a},chapClick:function(e){},toggleCatalog:function(){var e=this;if(e.closeAllLayer("isShowCatalog"),e.isShowCatalog=!e.isShowCatalog,e.isShowCatalog)for(var o=0;o<e.ebook.catalog.length;o++)if(e.viewCatalog.chapEleId==e.ebook.catalog[o].chapEleId){e.currentCatalog=e.viewCatalog;break}},toggleCode:function(){var e=this;e.closeAllLayer("isShowCode"),e.isShowCode=!e.isShowCode},toggleFeedback:function(){var e=this;e.closeAllLayer("isShowFeedback"),e.isShowFeedback=!e.isShowFeedback},toggleHelp:function(){var e=this;e.closeAllLayer("isShowHelp"),e.isShowHelp=!e.isShowHelp},toggleSet:function(){var e=this;e.closeAllLayer("isShowSet"),e.isShowSet=!e.isShowSet},toggleAddnote:function(e){var o=this;o.closeAllLayer("isShowAddnote"),o.isShowAddnote="close"!=e&&!o.isShowAddnote},_showTextMenu:function(e){var o=this;if(o.isCanNote){var t=$(e).offset().left,a=window.event||arguments.callee.caller.arguments[0],i=a.pageY;o.textMenuStyle={top:i+"px",left:t+"px"},o.isShowTextMenu=!0,$(e).addClass("active"),o.noteObjForHandle.images="",o.noteObjForHandle.chapName=app.viewCatalog.chapId,o.noteObjForHandle.userID=app.user.userID,o.noteObjForHandle.eBookID=app.bookId,o.noteObjForHandle.chapTitle=app.viewCatalog.navTitle,o.noteObjForHandle.page=0,o.noteObjForHandle.content="",o.noteObjForHandle.device="在线版",o.noteObjForHandle.eBookVersionNo=app.ebook.catalogVersion,o.noteObjForHandle.eBookPageUrl=apiHost.eshu+"/uploads/ebook/"+app.ebook.guid+"/mobile/epub/OEBPS/"+app.viewCatalog.chapId+".html",o.noteObjForHandle.eBookNoteColorNo=0,o.noteObjForHandle.cutOut=$(e).text(),o.noteObjForHandle.chapterStartPos=app.viewCatalog.chapPosIndex-1,o.noteObjForHandle.chapterEndPos=app.viewCatalog.chapPosIndex-1,o.noteObjForHandle.paragraphStartPos=$(e).attr("data-startp"),o.noteObjForHandle.paragraphEndPos=$(e).attr("data-endp"),o.noteObjForHandle.wordStartPos=0,o.noteObjForHandle.wordEndPos=$(e).text().length}},showAddNoteBox:function(e){var o=this;o.noteObjForHandle.type=e,o.isShowTextMenu=!1,"editNote"!=e&&(1!=o.uiConfig.needUploadImg&&"correction"!=e||html2canvas&&html2canvas(document.getElementById("readerContent"),{scale:1,logging:!1,useCORS:!0,width:$("#readerContent").innerWidth(),height:$("#readerContent").innerHeight(),y:$(document).scrollTop()}).then(function(e){var t=e.toDataURL();o.noteObjForHandle.images=t,Vue.set(o.noteObjForHandle,"images",t)})),o.toggleAddnote()},setNoteColor:function(e){var o=this;o.noteObjForHandle.eBookNoteColorNo=e.colorNo},onlyAddNoteColor:function(e){var o=this;if(o.user&&10009!=o.user.userID)o.noteObjForHandle.type="note",o.noteObjForHandle.content="",o.noteObjForHandle.eBookNoteColorNo=e,o.isShowTextMenu=!1,$("#readerContent .active").removeClass("active"),o.isSubmittingData=!0,1==o.uiConfig.needUploadImg?html2canvas&&html2canvas(document.getElementById("readerContent"),{scale:1,logging:!1,useCORS:!0,allowTaint:!1,width:$("#readerContent").innerWidth(),height:$("#readerContent").innerHeight(),y:$(document).scrollTop()}).then(function(e){var t=e.toDataURL();o.noteObjForHandle.images=t,Vue.set(o.noteObjForHandle,"images",t),o.submitAddNote("note")}):(o.noteObjForHandle.images="https://wx.100xuexi.com/images/noNoteImg.png",o.submitAddNote("note"));else{var t='<div class="com-popdialog-tips">使用此功能要先登录哦！</div>';o.$refs.scConfirm.show(t,{popDialogTitle:"温馨提示",cancelText:"暂不登录",confirmText:"去登录",type:"confirm",data:"gotologin",popDialogClass:""})}},submitAddNote:function(e,o){var t=this;if(t.user&&10009!=t.user.userID){if(""==t.noteObjForHandle.images&&""==t.noteObjForHandle.content){if(1==t.uiConfig.needUploadImg)return;t.noteObjForHandle.images="https://wx.100xuexi.com/images/noNoteImg.png"}t.isSubmittingData=!0;var a="note"==t.noteObjForHandle.type?apiHost.app+"/app/TalkHandler/TalkEBookPage.ashx?method=AddNotes":apiHost.app+"/app/TalkHandler/TalkEBookPage.ashx?method=AddFeedback",i="";if(i+="&userID="+t.noteObjForHandle.userID,i+="&eBookID="+t.noteObjForHandle.eBookID,i+="&chapTitle="+t.noteObjForHandle.chapTitle,i+="&page="+t.noteObjForHandle.page,i+="&cutOut="+t.noteObjForHandle.cutOut,i+="&content="+t.noteObjForHandle.content,i+="&device="+t.noteObjForHandle.device,i+="&eBookVersionNo="+t.noteObjForHandle.eBookVersionNo,i+="&eBookPageUrl="+t.noteObjForHandle.eBookPageUrl,i+="&eBookNoteColorNo="+t.noteObjForHandle.eBookNoteColorNo,i+="&chapterStartPos="+t.noteObjForHandle.chapterStartPos,i+="&chapterEndPos="+t.noteObjForHandle.chapterEndPos,i+="&paragraphStartPos="+t.noteObjForHandle.paragraphStartPos,i+="&paragraphEndPos="+t.noteObjForHandle.paragraphEndPos,i+="&wordStartPos="+t.noteObjForHandle.wordStartPos,i+="&wordEndPos="+t.noteObjForHandle.wordEndPos,""!=t.noteObjForHandle.images&&1==t.uiConfig.needUploadImg)$.post("/app/CommonFileUpload.ashx",{data:t.noteObjForHandle.images},function(e){var n="",r="";e&&0==e.error?(n=e.url,r=e.smallUrl):console.log("截图上传失败，请重试"),i+="&images="+n+","+r,i=encodeURI(i);postRequest(a,i,function(e){1==e.result?(!0,e.talk.chapName=t.noteObjForHandle.chapName,e.talk.colorNo=e.talk.eBookNoteColorNo,t.chapNoteList.push(e.talk),t._lightNoteInBook(e.talk),t.toggleAddnote("close")):(alert(e.errMsg),!1),o&&o(),t.isSubmittingData=!1})},"json");else{i+="&images="+t.noteObjForHandle.images,i=encodeURI(i);postRequest(a,i,function(e){1==e.result?(!0,e.talk.chapName=t.noteObjForHandle.chapName,e.talk.colorNo=e.talk.eBookNoteColorNo,t._lightNoteInBook(e.talk),t.toggleAddnote("close")):(alert(e.errMsg),!1),o&&o(),t.isSubmittingData=!1})}}else{var n='<div class="com-popdialog-tips">使用此功能要先登录哦！</div>';t.$refs.scConfirm.show(n,{popDialogTitle:"温馨提示",cancelText:"暂不登录",confirmText:"去登录",type:"confirm",data:"gotologin",popDialogClass:""})}},editNote:function(e){var o=this;if(""!=e&&0!=o.chapNoteList.length){for(var t=null,a=0;a<o.chapNoteList.length;a++)if(e==o.chapNoteList[a].talkID){t=o.chapNoteList[a];break}null!=t&&(t.images&&"object"==typeof t.images&&(t.imagesArr=t.images,t.images=null!=t.images&&t.images.length>0?t.images[0].ImageUrl:""),o.noteObjForHandle=t,o.showAddNoteBox("editNote"))}},submitEditNote:function(){var e=this;if(e.user&&10009!=e.user.userID){if(""!=e.noteObjForHandle.talkID){e.isSubmittingData=!0;var o=apiHost.app+"/app/TalkHandler/TalkEBookPage.ashx?method=UpdateEbookNote2",t="";if(t+="&talkID="+e.noteObjForHandle.talkID,t+="&userID="+e.noteObjForHandle.userID,t+="&cutOut="+e.noteObjForHandle.cutOut,t+="&content="+e.noteObjForHandle.content,t+="&eBookNoteColorNo="+e.noteObjForHandle.eBookNoteColorNo,t+="&chapterStartPos="+e.noteObjForHandle.chapterStartPos,t+="&chapterEndPos="+e.noteObjForHandle.chapterEndPos,t+="&paragraphStartPos="+e.noteObjForHandle.paragraphStartPos,t+="&paragraphEndPos="+e.noteObjForHandle.paragraphEndPos,t+="&wordStartPos="+e.noteObjForHandle.wordStartPos,t+="&wordEndPos="+e.noteObjForHandle.wordEndPos,null!=e.noteObjForHandle.imagesArr&&e.noteObjForHandle.imagesArr.length>0){var a=e.noteObjForHandle.imagesArr[0].ImageUrl,i=e.noteObjForHandle.imagesArr[0].SmallImageUrl;t+="&images="+a+","+i}t+="&token="+md5("UpdateEbookNote2_"+e.user.userID+"_"+e.noteObjForHandle.talkID+"_scxuexi"),t=encodeURI(t);postRequest(o,t,function(o){if(1==o.result){!0,$('span[id="note-'+e.noteObjForHandle.talkID+'"]').each(function(e,o){$(o).find("i").remove,$(o).prop("outerHTML",$(o)[0].innerHTML)}),o.talk.chapName=e.noteObjForHandle.chapName,o.talk.colorNo=o.talk.eBookNoteColorNo;for(var t=0;t<e.chapNoteList.length;t++)if(o.talk.talkID==e.chapNoteList[t].talkID){e.chapNoteList[t]=o.talk;break}e._lightNoteInBook(o.talk),e.toggleAddnote()}else alert(o.errMsg),!1;e.isSubmittingData=!1})}}else{var n='<div class="com-popdialog-tips">使用此功能要先登录哦！</div>';e.$refs.scConfirm.show(n,{popDialogTitle:"温馨提示",cancelText:"暂不登录",confirmText:"去登录",type:"confirm",data:"gotologin",popDialogClass:""})}},toggleNote:function(){var e=this;e.closeAllLayer("isShowNote"),e.isShowNote=!e.isShowNote,e.isShowNote&&!e.noteListHasLoad&&e.getNoteList()},toggleBookmark:function(){var e=this;e.closeAllLayer("isShowBookmark"),e.isShowBookmark=!e.isShowBookmark},toggleSearch:function(){var e=this;e.closeAllLayer("isShowSearch"),e.isShowSearch=!e.isShowSearch},toggleWrong:function(){var e=this;e.closeAllLayer("isShowWrong"),e.isShowWrong=!e.isShowWrong,e.isShowWrong&&(console.log("刷新纠错列表"),e.$refs.errorCorrectionBox.refreshCommentList())},closeAllLayer:function(e){var o=this,t=["isShowCatalog","isShowCode","isShowFeedback","isShowHelp","isShowSet","isShowNote","isShowBookmark","isShowSearch","isShowWrong","isShowAddnote","isShowUnseal"];if(e)for(var a=0;a<t.length;a++)e!=t[a]&&(o[t[a]]=!1);else for(a=0;a<t.length;a++)o[t[a]]=!1},setUI:function(e,o){var t=this;"fontSize"==e?(t.uiConfig.fontSize=o,$("html").css("font-size",o)):"fontFamily"==e?t.uiConfig.fontFamily=o:"backgroundColor"==e?(t.uiConfig.backgroundColor=o,$(".BtnShowAnsCon").css("background-color",t.uiConfig.backgroundColor)):"backgroundClass"==e?t.uiConfig.backgroundClass=o:"isshowaichatbtn"==e&&(t.uiConfig.isShowAIChatBtn=o)},reSetUI:function(){var e=this;e.uiConfig={fontSize:"62.5%",fontFamily:"",backgroundColor:"#ffffff",backgroundClass:"random-bg-0",needUploadImg:1,shortcutKey:1,isShowAIChatBtn:!0},$("html").css("font-size",e.uiConfig.fontSize),$(".BtnShowAnsCon").css("background-color",e.uiConfig.backgroundColor)},saveUIConfig:function(e){var o=this,t=JSON.stringify(o.uiConfig);""!=t&&localStorage.setItem("scReaderConfig_v"+scReaderVision,t),"close"==e&&(o.isShowSet=!1)},selectFontSize:function(){var e=this;e.setUI("fontSize",e.uiConfig.fontSize)},selectFontFamily:function(){var e=this;e.setUI("fontFamily",e.uiConfig.fontFamily)},changeIsShowAIChatBtn:function(){var e=this;e.setUI("isshowaichatbtn",e.uiConfig.isShowAIChatBtn)},_validateMobile:function(e){var o=/(^1[3|4|5|6|7|8|9][0-9]{9}$)/;return o.test(e)},_getOS:function(){var e=navigator.userAgent,o="Win32"==navigator.platform||"Windows"==navigator.platform,t="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(t)return"Mac";var a="X11"==navigator.platform&&!o&&!t;if(a)return"Unix";var i=String(navigator.platform).indexOf("Linux")>-1;if(i)return"Linux";if(o){var n=e.indexOf("Windows NT 5.0")>-1||e.indexOf("Windows 2000")>-1;if(n)return"Win2000";var r=e.indexOf("Windows NT 5.1")>-1||e.indexOf("Windows XP")>-1;if(r)return"WinXP";var s=e.indexOf("Windows NT 5.2")>-1||e.indexOf("Windows 2003")>-1;if(s)return"Win2003";var l=e.indexOf("Windows NT 6.0")>-1||e.indexOf("Windows Vista")>-1;if(l)return"WinVista";var d=e.indexOf("Windows NT 6.1")>-1||e.indexOf("Windows 7")>-1;if(d)return"Win7";var c=e.indexOf("Windows NT 10")>-1||e.indexOf("Windows 10")>-1;if(c)return"Win10"}return"other"},_getImagesStr:function(){var e=this,o="";if(0==e.feedImgList.length)return o;for(var t=[],a=0;a<e.feedImgList.length;a++)t.push(e.feedImgList[a].url+","+e.feedImgList[a].smallUrl);return t.join(";")},sendFeedback:function(){var e=this;if(!e.feedLoadLock){if(null==e.feedContent||""==e.feedContent)return alert(" 请填写反馈内容！"),!1;if(!e.userContactWay||!e._validateMobile(e.userContactWay))return alert(" 请填写有效的手机号！"),!1;e.feedLoadLock=!0;var o=e._getOS(),t="",a="",i="圣才电子书Web版",n=scReaderVision,r=3,s=e._getImagesStr(),l=apiHost.wx+"/handle/AppFeedBack.ashx?method=AddUserFeedBack",d="&allUserId="+e.user.userID;d+="&feedbackContent="+e.feedContent,d+="&userContactWay="+e.userContactWay,d+="&phoneType="+t,d+="&OSType="+o,d+="&iosToken="+a,d+="&images="+s,d+="&appName="+i,d+="&appVersion="+n,d+="&terminalNo="+r,postRequest(l,d,function(o){"1"==o.result?(e.feedContent="",e.feedImgList=[],e.userContactWay=e.user.mobile,alert("提交成功,感谢您的反馈，我们将尽快处理！"),e.closeAllLayer()):alert(o.errMsg),e.feedLoadLock=!1})}},fileChange:function(e){var o=this;if(e.target.files[0].size){var t=e.target.files;if(t.length+o.feedImgList.length>5)alert("图片数量不能超过5张");else for(var a=0;a<t.length;a++)if(t[a].type.indexOf("image")>=0){if(!window.FileReader){alert("当前浏览器不支持上传图片");break}var i=new FileReader;i.readAsDataURL(t[a]),i.onloadend=function(e){$.post("/app/CommonFileUpload.ashx",{data:e.target.result},function(e){0==e.error&&o.feedImgList.push({url:e.url,smallUrl:e.smallUrl})},"json")}}else alert("请选择图片文件上传")}},delFeedImg:function(e){for(var o=this,t=0;t<o.feedImgList.length;t++)e==o.feedImgList[t].url&&o.feedImgList.splice(t,1)},scrollHandle:function(e){var o=this;e.wheelDelta?(e.wheelDelta>0&&-1,e.wheelDelta):e.detail&&(e.detail>0&&1,e.detail),scrollTimer&&clearTimeout(scrollTimer),scrollTimer=setTimeout(function(){0!=o.bookmarkList.length?o._lightBookMark():o.bookmarkIsLight=!1},500)},_checkScrollToBottom:function(e){var o=!1,t=$(e).scrollTop(),a=$(e)[0].scrollHeight,i=$(e).outerHeight();return t+i>=a&&(o=!0),o},_checkScrollToTop:function(e){var o=!1,t=$(e).scrollTop();return 0==t&&(o=!0),o},_getFinalChap:function(e){for(var o=this,t=null,a=[],i=0;i<o.ebook.catalog.length;i++)e==o.ebook.catalog[i].chapId&&a.push(o.ebook.catalog[i]);return a.length>0&&(t=a[a.length-1]),t},pageKeyup:function(){var e=this;document.onkeydown=function(o){var t=window.event||event,a=t.keyCode,i=!!t.target&&("textarea"==t.target.nodeName.toLowerCase()||"input"==t.target.nodeName.toLowerCase());if(40==a)i||$("#readerContent").focus();else if(38==a)i||$("#readerContent").focus();else if(39==a)i||1!=e.uiConfig.shortcutKey||($("#readerContent").focus(),e.skipToNextChap());else if(37==a)i||1!=e.uiConfig.shortcutKey||($("#readerContent").focus(),e.skipToPrevChap());else if(33==a)i||$("#readerContent").focus();else if(34==a)i||$("#readerContent").focus();else if(36==a)i||$("#readerContent").focus();else if(35==a)i||$("#readerContent").focus();else if(122==a)i||$("#readerContent").focus();else{if(123==a)return!1;if(18==a)return!1;if(o.altKey)return!1;if(o.ctrlKey)return!1}},document.oncontextmenu=function(){return!1}},skipToChap:function(e,o,t,a){var i=this;if("cover"==o){var n="readRecord_"+i.user.userID+"_"+i.bookId;localStorage.removeItem(n),saveReadeRecordInterval&&clearInterval(saveReadeRecordInterval)}if(i.checkIsCanRead(e)){i.maskLoading=!0;var r=i._getUrlQueryParams(window.location.href),s=window.location.protocol+"//"+window.location.host+window.location.pathname,l=[],d=!1,c=!1;for(var p in o="cover"==o?"":o,r)"chapid"==p.toLowerCase()?(l.push(p+"="+o),d=!0):"pid"==p.toLowerCase()?(a&&l.push(p+"="+a),c=!0):l.push(p+"="+r[p]);d||l.push("chapId="+o),!c&&a&&l.push("pId="+a),s+="?"+l.join("&"),i._setStudyHistroy(function(){i.closeAllLayer(),setTimeout(()=>{window.location.replace(s)},200)})}else if(i.isCol)i.$refs.scConfirm.show('<div class="com-popdialog-tips">暂无阅读权限<br/>阅读完整内容请联系我们<br/>（电话：4009622585）</div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""});else if(i.isLibrary)i.isLibraryUser?i.$refs.scConfirm.show('<div class="com-popdialog-tips">暂无阅读权限</div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""}):i.$refs.scConfirm.show('<div class="com-popdialog-tips">非授权用户，暂无阅读权限</div>',{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""});else if(i.isWpsMiniprogram){var g='<div class="com-popdialog-tips">试读已结束<br/>开通题库权益后可阅读完整内容</div>';i.$refs.scConfirm.show(g,{popDialogTitle:"温馨提示",cancelText:"取消",confirmText:"开通题库权益",type:"confirm",data:"gotobuy",popDialogClass:"wps-popdialog-box"}),wpsGetUserVipInfo(function(e){dataCollect(e,"docer_tiku_display",{page_name:"preview_detail",page_position:"",module_name:"pay_box",module_position:"",element_name:"",element_position:"",element_type:"module",event_time:getNowFullTime().fullDateTime,resource_id:i.bookId,resource_type:"book",file_type:"",pre_klm:preKlm})}),wpsGetUserVipInfo(function(e){dataCollect(e,"docer_tiku_display",{page_name:"preview_detail",page_position:"",module_name:"pay_box",module_position:"",element_name:"vip_btn",element_position:"",element_type:"button",event_time:getNowFullTime().fullDateTime,resource_id:i.bookId,resource_type:"book",file_type:"",pre_klm:preKlm})})}else{g='<div class="com-popdialog-tips">您尚未购买<br/>购买后可阅读完整内容</div>';i.isZxxProduct||0!=$("#hiddenVipBuyPrice").val()||1!=$("#hiddenIsShowBuyVip").val()?i.isZxxProduct&&0==$("#hiddenVipZxxBuyPrice").val()&&1==$("#hiddenIsShowBuyVip").val()&&(g='<div class="com-popdialog-tips">您尚开通中小学VIP会员（KVIP）<br/>开通KVIP后可阅读完整内容</div>',i.$refs.scConfirm.show(g,{popDialogTitle:"温馨提示",cancelText:"取消",confirmText:"开通KVIP",type:"confirm",data:"gotobuyvip"})):(g='<div class="com-popdialog-tips">您尚未购买<br/>购买或开通VIP会员后可阅读完整内容</div>',i.$refs.scConfirm.show(g,{popDialogTitle:"温馨提示",cancelText:"取消",confirmText:"立即购买",type:"confirm",data:"gotobuy"}))}},_getUrlQueryParams:function(e){var o={},t=e.split("?");if(t[1]){e=t[1];var a=e.split("&");if(a.length>0)for(var i=[],n="",r="",s=0;s<a.length;s++)i=a[s].split("="),n=null!=i[0]&&null!=i[0]?i[0]:"",r=null!=i[1]&&null!=i[1]?i[1]:"",""!=n&&(o[n]=r)}return o},skipToPositon:function(e){var o=this;if($("#"+e).length>0){var t=$("#origin").offset().top,a=$("#"+e).offset().top;$("#readerContent").scrollTop(a-t+20),o.closeAllLayer()}else o.toast("段落不存在")},checkIsCanRead:function(e){for(var o=this,t=!1,a=0;a<o.ebook.catalog.length;a++)if(o.ebook.catalog[a].chapEleId==e){o.ebook.catalog[a].isFree&&(t=!0);break}return t},skipToPrevChap:function(){var e=this;if(null!=e.viewCatalog)for(var o=e.viewCatalog.chapId,t=0;t<e.ebook.catalog.length;t++)if(e.ebook.catalog[t].chapId==o){if(t>0){e.ebook.catalog[t-1].isCanShow?e.skipToChap(e.ebook.catalog[t-1].chapEleId,e.ebook.catalog[t-1].chapId,"up"):t-1>0?e.skipToChap(e.ebook.catalog[t-2].chapEleId,e.ebook.catalog[t-2].chapId,"up"):e.toast("已经是第一章节了");break}e.toast("已经是第一章节了")}},skipToNextChap:function(){var e=this;if(null!=e.currentCatalog)for(var o=e.viewCatalog.chapId,t=e.ebook.catalog.length-1;t>=0;t--)if(e.ebook.catalog[t].chapId==o){if(t<e.ebook.catalog.length-1){e.ebook.catalog[t+1].isCanShow?e.skipToChap(e.ebook.catalog[t+1].chapEleId,e.ebook.catalog[t+1].chapId,"down"):t+1<e.ebook.catalog.length-1?e.skipToChap(e.ebook.catalog[t+2].chapEleId,e.ebook.catalog[t+2].chapId,"down"):e.toast("已经是最后章节了");break}e.toast("已经是最后章节了")}},getNoteList:function(){var e=this;if(!e.user||10009==e.user.userID)return e.noteListHasLoad=!0,void(e.noteListHasMore=!1);if(!e.noteListLoadLock){e.noteListLoadLock=!0,e.noteListHasLoad=!0;var o="https://app.100xuexi.com/App/TalkHandler/TalkQuery.ashx?method=GetAllByParam4";o+="&categoryID=0",o+="&content=",o+="&noCache=1",o+="&pageIndex="+e.noteListPageIndex,o+="&pageSize="+e.noteListPageSize,o+="&platID=1",o+="&productID="+e.bookId,o+="&type=3",o+="&unUserID=",o+="&userID="+e.user.userID,getRequest(o,function(o){if(o&&o.talks){e.noteListCount=o.page.RecordCount;for(var t=0;t<o.talks.length;t++){if(o.talks[t].chapId=o.talks[t].chapName.replace(".html",""),o.talks[t].chapEleId=e._getChapEleIdByNote(o.talks[t].chapterStartPos),o.talks[t].chapTitleObj=e._getChapNameByNote(o.talks[t].chapId),o.talks[t].selectionClass="note-"+o.talks[t].colorNo,o.talks[t].domPId=o.talks[t].chapId+"_"+o.talks[t].paragraphStartPos,o.talks[t].domId="note-"+o.talks[t].talkID,o.talks[t].images&&o.talks[t].images.length>0)for(var a=0;a<o.talks[t].images.length;a++)if(""!=o.talks[t].images[a].ImageUrl){var i=o.talks[t].images[a].ImageUrl.indexOf("_"),n=o.talks[t].images[a].ImageUrl.lastIndexOf("."),r=o.talks[t].images[a].ImageUrl.substring(i+1,n),s=r.split("_");o.talks[t].images[a].width=s[0],o.talks[t].images[a].height=s[1]}e.noteList.push(o.talks[t]),e._findNote(o.talks[t]),e._lightNoteInBook(o.talks[t])}e.noteListLoadLock=!1,o.page.PageCount>e.noteListPageIndex+1?(e.noteListHasMore=!0,e.noteListPageIndex++,e.getNoteList()):e.noteListHasMore=!1}})}},refreshNote:function(){var e=this;e.noteList=[],e.noteListPageIndex=0,e.getNoteList()},_getChapNameByNote:function(e){for(var o=this,t=e,a="",i="",n=[],r=0;r<o.ebook.catalog.length;r++)t==o.ebook.catalog[r].chapId&&n.push(o.ebook.catalog[r]);return n.length>0&&(a=n[n.length-1].navTitle,i=n[n.length-1].parentNode.length>0?n[n.length-1].parentNode[0].navTitle:""),{chapTitle:a,parentChapTitle:i}},_getChapEleIdByNote:function(e){for(var o=this,t=0;t<o.ebook.catalog.length;t++)if(o.ebook.catalog[t].chapPosIndex==e+1)return o.ebook.catalog[t].chapEleId;return""},deleteNote:function(e){var o=this;o.user&&10009!=o.user.userID&&o.$refs.scConfirm.show("确定要删除该条记录吗？",{popDialogTitle:"温馨提示",cancelText:"取消",confirmText:"确定",type:"confirm",data:"deleteNote",paramesjson:JSON.stringify({id:e})})},_deleteNoteByServer:function(e){var o=this,t=e.id;o.isShowNoteDetail=!1;var a=$("#hiddenDeleteTalkToken").val()||"",i="https://app.100xuexi.com/App/TalkHandler/TalkReply.ashx?method=DeleteTalk";i+="&token="+a,i+="&talkID="+t,i+="&userID="+o.user.userID,getRequest(i,function(e){if(e&&1==e.result){$('span[id="note-'+t+'"]').each(function(e,o){$(o).find("i").remove,$(o).prop("outerHTML",$(o)[0].innerHTML)}),o.toast("删除成功");for(var a=0;a<o.noteList.length;a++)if(t==o.noteList[a].talkID)return o.noteList.splice(a,1),void o.noteListCount--}else o.$refs.scConfirm.show('<div class="com-popdialog-tips">删除失败：'+e.msg+"</div>",{popDialogTitle:"温馨提示",cancelText:"知道了",confirmText:"",type:"alert",data:""})})},_showNoteDetail:function(e,o,t,a){var i=this;i.noteDetail.noteDetailId=a,i.noteDetail.noteDetailText=t,i.noteDetail.noteDetailStyle={top:o+"px",left:e+"px"},i.isShowNoteDetail=!0},_hideNoteDetail:function(){var e=this;e.isShowNoteDetail=!1},skipToNotePosition:function(e){var o=this;""!=e.chapEleId&&(e.chapEleId==o.viewCatalog.chapEleId?e.domId&&o.skipToPositon(e.domId):o.skipToChap(e.chapEleId,e.chapId,"up",e.domId))},_lightNoteInBook:function(e){function o(e){for(var o=0;o<e.childNodes.length;o++){var t=e.childNodes[o];if("#text"!=t.nodeName.toLowerCase())return!1}return!0}function t(a,i,n){var r=!1;obj=a[0];try{for(var s=0,l=0;l<obj.childNodes.length;l++){var d=obj.childNodes[l],c=d.textContent,p=c.length,g=s,u=s+p;if(p>0&&g<n&&u>i)if(g<i&&(g=i),u>n&&(u=n),d.childNodes.length>0&&!o(d))t(d,g-s,u-s);else{var h=c.substring(0,g-s),m=c.substring(g-s,u-s),f=c.substring(u-s,p);"#text"==d.nodeName.toLowerCase()?$(d).replaceWith(h+'<span id="note-'+e.talkID+'" class="note-mark note-'+e.colorNo+'" onmouseenter="showNoteDetail(this)" onmouseleave="hideNoteDetail()" data-note-content="'+e.content+'">'+m+"</span>"+f):g-s==0&&u-s==p?d.innerHTML='<span id="note-'+e.talkID+'" class="note-mark note-'+e.colorNo+'" onmouseenter="showNoteDetail(this)" onmouseleave="hideNoteDetail()" data-note-content="'+e.content+'">'+m+"</span>"+f:(d.innerHTML=h+'<span id="note-'+e.talkID+'" class="note-mark note-'+e.colorNo+'" onmouseenter="showNoteDetail(this)" onmouseleave="hideNoteDetail()" data-note-content="'+e.content+'">'+m+"</span>"+f,d.nodeName.toLowerCase())}s+=p}r=!0}catch(e){throw r=!1,e}finally{return r}}var a=e.chapName.replace(".html","")+"_";if(!($("#note-"+e.talkID).length>0)){var i={domPId:a+e.paragraphStartPos,wordStartPos:e.wordStartPos,wordEndPos:e.wordEndPos,paragraphStartPos:e.paragraphStartPos,paragraphEndPos:e.paragraphEndPos,domId:"note-"+e.talkID,selectionClass:"note-"+e.colorNo};if(i.paragraphStartPos==i.paragraphEndPos){var n=$("#"+a+i.paragraphStartPos);if(n.length>0){var r=n.text(),s=i.wordStartPos,l=i.wordEndPos;t(n,s,l),e.content&&""!=e.content&&$(".note-mark[id='note-"+e.talkID+"']:last").append("<i></i>")}}else{for(var d=i.paragraphStartPos;d<i.paragraphEndPos+1;d++){n=$("#"+a+d);if(n.length>0){r=n.text();if(r.length>0)if(d==i.paragraphStartPos){s=i.wordStartPos,l=r.length;t(n,s,l)}else if(d>i.paragraphStartPos&&d<i.paragraphEndPos){s=0,l=r.length;t(n,s,l)}else if(d==i.paragraphEndPos){s=0,l=i.wordEndPos;t(n,s,l)}}}e.content&&""!=e.content&&$(".note-mark[id='note-"+e.talkID+"']:last").append("<i></i>")}}},_findNote:function(e){var o=this,t="",a="",i=o.viewCatalog.chapEleId;if(0!=$("#"+i).length){var n=$("#"+i).children("p");if(e.startP=e.paragraphStartPos,e.endP=e.paragraphEndPos,e.start=e.wordStartPos,e.end=e.wordEndPos,e.text=e.cutOut,e.startP<0||e.endP>=n.length||e.startP>e.endP)a="fail";else{for(var r=e.startP;r<=e.endP;r++){var s=$(n[r]).text();try{s=s.substring(r==e.startP?e.start:0,r==e.endP?e.end:s.length)}catch(e){a="fail";break}t+=s}a=t.indexOf(e.text)<0&&t.replace("\r","").replace("\n","").indexOf(e.text.replace("\r","").replace("\n",""))<0&&t.replace(" ","").indexOf(e.text.replace(" ",""))<0?"fail":"success"}if("fail"==a){var l=$("#"+i).text();if(l.indexOf(e.text)>=0||l.replace("\r","").replace("\n","").indexOf(e.text.replace("\r","").replace("\n",""))>=0||l.replace(" ","").indexOf(e.text.replace(" ",""))>=0){var d="";if(e.endP<n.length&&e.startP>=0)for(r=e.startP;r<=e.endP;r++){s=$(n[r]).text();d+=s}for(var c=-1,p=null,g=2*Math.max(e.startP,n.length-e.endP),u=e.startP,h=e.endP;c<g;){if(c++,c>0&&c%2==0){var m=e.endP+Math.ceil(c/2);if(m<0||m>=n.length)continue;s=$(n[m]).text();d+=s,h=m}if(c>0&&c%2==1){m=e.startP-Math.ceil(c/2);if(m<0||m>=n.length)continue;s=$(n[m]).text();d=s+d,u=m}var f=d,v=e.text,k=!1;f.indexOf(v)<0&&(f=d.replace("\r","").replace("\n","").replace(" ",""),v=e.text.replace("\r","").replace("\n","").replace(" ",""),k=!0);for(var w=0;f.indexOf(v)>=0;){var b=f.indexOf(v),I=b+v.length,C=o.findNoteInChap(e,n,b+w,I+w,u,h,k);if(f=f.substring(I),w+=I,null!=C){if(C.start==e.start&&C.end==e.end){p=C,c=g;break}var x=o.comPileIndex(C,e,p);x&&(p=C)}}}null!=p&&(e.startP=p.startP,e.endP=p.endP,e.start=p.start,e.end=p.end,e.paragraphStartPos=e.startP,e.paragraphEndPos=e.endP,e.wordStartPos=e.start,e.wordEndPos=e.end,a="success")}}}},comPileIndex:function(e,o,t){try{if(null==e)return!1;if(null==t)return!0;var a=Math.abs(o.start-t.start)+Math.abs(o.end-t.end),i=Math.abs(o.start-e.start)+Math.abs(o.end-e.end);if(a!=i)return i<a;var n=Math.abs(o.startP-t.startP)+Math.abs(o.endP-t.endP),r=Math.abs(o.startP-e.startP)+Math.abs(o.endP-e.endP);return r<n}catch(e){}return!1},findNoteInChap:function(e,o,t,a,i,n,r){try{for(var s=0,l=-1,d=-1,c=-1,p=-1,g=i;g<=n;g++){var u=$(o[g]).text();if(r&&(u=u.replace("\r","").replace("\n","").replace(" ","")),""!=u&&""!=$.trim(u)){if(s<=t&&s+u.length>=t&&(l=g,c=t-s),s<=a&&s+u.length>=a&&(d=g,p=a-s),l>=0&&d>=0)break;s+=u.length}}if(l<0||d<0)return null;var h={};if(h.startP=l,h.endP=d,r)if(l==d){var m=$(o[l]).text(),f=m.indexOf(e.text,c),v=f+e.text.length;if(f<0)return null;h.start=f,h.end=v}else{m=$(o[l]).text(),f=m.length;for(var k=m.length;k>0;k--){var w=m.substring(k-1);if(e.text.indexOf(w)<0)break;f=k-1}var b=$(o[d]).text();for(v=0,k=0;k<b.length;k++){w=b.substring(0,k+1)
;if(e.text.indexOf(w)<0)break;v=k+1}h.start=f,h.end=v}else h.start=c,h.end=p;return h}catch(e){}return null},addBookmark:function(){var e=this,o="",t=$("#"+e.viewCatalog.chapId),a=$("#readerContent").height(),i=[],n=[];if(t.find("p").length>0)for(var r=0;r<t.find("p").length;r++){var s=t.find("p")[r],l=$(s).offset().top-117;l>=0&&l<a&&(i.push(s),n.push($(s).attr("id")))}if(i.length>0)for(r=0;r<i.length;r++)o+=$(i[r]).text();var d={id:(new Date).getTime(),parentChapName:e.viewCatalog.parentNode.length>0?e.viewCatalog.parentNode[0].navTitle:"",chapName:e.viewCatalog.navTitle,quote:o,time:dateFormat(new Date),ps:n,chapId:e.viewCatalog.chapId,chapEleId:e.viewCatalog.chapEleId};e.bookmarkList.unshift(d),e._saveLocalBookmarkList(),e._lightBookMark()},deleteCurrentBookmark:function(){var e=this;null!=e.currentBookMark&&e.deleteBookmark(e.currentBookMark.id)},deleteBookmark:function(e){var o=this;for(i=0;i<o.bookmarkList.length;i++)if(e==o.bookmarkList[i].id){o.bookmarkList.splice(i,1);break}o._saveLocalBookmarkList(),o._lightBookMark()},deleteAllBookmark:function(){var e=this;e.$refs.scConfirm.show("确定要删除全部书签吗？",{popDialogTitle:"温馨提示",cancelText:"取消",confirmText:"确定",type:"confirm",data:"deleteAllBookmark"})},_deleteAllBookmarkLocal:function(){var e=this;e.bookmarkList=[],e._saveLocalBookmarkList()},_lightBookMark:function(){var e=this,o=$("#"+e.viewCatalog.chapId),t=e.$refs.readerContent.offsetHeight,a=[],i=[];if(o.find("p").length>0)for(var n=0;n<o.find("p").length;n++){var r=o.find("p")[n],s=$(r).offset().top-117;s>=0&&s<t&&a.push($(r).attr("id"))}if(e.bookmarkList.length>0)for(n=0;n<e.bookmarkList.length;n++)i=i.concat(e.bookmarkList[n].ps);e._checkArrHasSameEle(i,a)?e.bookmarkIsLight=!0:e.bookmarkIsLight=!1,e._getCurrentBookMark(a)},_checkArrHasSameEle:function(e,o){if(0==e.length||0==o.length)return!1;for(var t=[],a=0;a<e.length;a++)for(j=0;j<o.length;j++)e[a]==o[j]&&t.push(e[a]);return t.length>0},_getCurrentBookMark:function(e){var o=this;if(o.bookmarkList.length>0)for(var t=0;t<o.bookmarkList.length;t++)for(var a=0;a<o.bookmarkList[t].ps.length;a++)for(k=0;k<e.length;k++)if(o.bookmarkList[t].ps[a]==e[k])return void(o.currentBookMark=o.bookmarkList[t])},_getBookmarkList:function(){var e=this,o="bookmarklist_"+e.user.userID+"_"+e.bookId,t=localStorage.getItem(o)||"";""!=t&&(e.bookmarkList=JSON.parse(t))},_saveLocalBookmarkList:function(){var e=this,o="bookmarklist_"+e.user.userID+"_"+e.bookId;localStorage.setItem(o,JSON.stringify(e.bookmarkList))},skipToBookmark:function(e){var o=this;e.chapEleId==o.viewCatalog.chapEleId?e.ps.length>0&&o.skipToPositon(e.ps[0]):o.skipToChap(e.chapEleId,e.chapId,"up",e.ps[0])},searchInBook:function(){var e=this;if(e.searchResultList=[],""!=e.searchKey){var o=e.searchKey,t=new RegExp(o,"ig");$("#readerContent p").length>0&&$("#readerContent p").each(function(o,a){t.test($(a).text())&&e.searchResultList.push({paragraphId:$(a).attr("id"),text:$(a).html()})})}},skipToSearchResult:function(e){var o=this;o.skipToPositon(e)},toast:function(e){var o=this;o.toastHtml=e,toastTimer&&clearTimeout(toastTimer),toastTimer=setTimeout(function(){o.toastHtml=""},3e3)},_getReadRecord:function(e){var o=this,t="readRecord_"+o.user.userID+"_"+o.bookId,a=localStorage.getItem(t)||"";""!=a&&(o.readRecord=JSON.parse(a)),e&&e()},_setReadRecord:function(){var e=this;if(e.viewCatalog){var o="readRecord_"+e.user.userID+"_"+e.bookId;if("chapEle0"==e.viewCatalog.chapEleId)return localStorage.removeItem(o),!1;e._getReadRecord();for(var t="",a=null,i=$("#readerContent .chap p").length,n=$("#readerContent").offset().top,r=0,s=i-1,l=0;1!=i;)l=parseInt((r+s)/2),a=$($("#readerContent .chap p")[l]),a.offset().top-n>=0?(r=r,s=l,i=parseInt(i/2)):(r=l,s=s,i=parseInt(i/2));if(a=$($("#readerContent .chap p")[l]),t=a.attr("id"),""==t)return!1;if(e.readRecord&&e.readRecord.pId==t&&e.readRecord.chapEleId==e.viewCatalog.chapEleId)return!1;var d={chapEleId:e.viewCatalog.chapEleId,chapId:e.viewCatalog.chapId,pId:t};localStorage.setItem(o,JSON.stringify(d))}},_skipToReadRecord:function(e){var o=this;o.readRecord.chapEleId==o.viewCatalog.chapEleId?""!=o.readRecord.pId&&(o.skipToPositon(o.readRecord.pId),e&&e()):o.skipToChap(o.readRecord.chapEleId,o.readRecord.chapId,"up",o.readRecord.pId)},_setStudyHistroy:function(e){var o=this;if(o.user&&10009!=o.user.userID&&!o.isLibrary)if(o.user.userID&&o.bookId){var t=apiHost.app+"/StudyHistory/EbookStudyRecord.ashx?method=Add",a="",i=o.viewCatalog.chapId,n=(($("#readerContent").scrollTop()+$("#readerContent")[0].offsetHeight)/$("#readerContent")[0].scrollHeight).toFixed(2);n=n<=0?0:n>=1?1:n,a+="&userId="+o.user.userID,a+="&bookId="+o.bookId,a+="&chapId="+i,a+="&chapName="+o.viewCatalog.navTitle,a+="&startTime="+o.readStartTime,a+="&endTime="+(new Date).format("yyyy-MM-dd hh:mm:ss"),a+="&useRate="+n,a+="&osType=pcH5",a+="&version=",a+="&token="+md5("Add_"+o.user.userID+"_"+o.bookId+"_"+i+"_scxuexi"),a=encodeURI(a),postRequest(t,a,function(o){o.result,e&&e()})}else e&&e();else e&&e()},_addUserTrack:function(){var e=this,o=$("#hiddenUserId").val();if(""!=o&&"10009"!=o){var t=apiHost.wx+"/handle/UserTrackHandler.ashx?method=AddFavor",a="&id="+(""!=e.packageId?e.packageId:e.bookId);a+="&user_id="+o,a+="&platnum=1&trackType=1",e.agentName&&(a+="&XA="+e.agentName),postRequest(t,a,function(e){e.result})}},_openImgViewer:function(e,o,t,a,i){var n=this;n.imgViewerSrc=e,n.isShowImgViewer=!0,n.imgViewerStyle={left:o,top:t,width:a,height:i}},zoomimg:function(e){var o=this,t=0;e||(e=window.event),e.wheelDelta?(t=e.wheelDelta/120,window.opera&&(t=-t)):e.detail&&(t=-e.detail/3),readerWidth=$(".reader").width(),readerHeight=$(".reader").height(),t>0?o.imgViewerStyle.width<=.9*readerWidth&&(o.imgViewerStyle={left:(readerWidth-1.1*o.imgViewerStyle.width)/2,top:(readerHeight-1.1*o.imgViewerStyle.height)/2,width:1.1*o.imgViewerStyle.width,height:1.1*o.imgViewerStyle.height}):t<0&&o.imgViewerStyle.width>=10&&(o.imgViewerStyle={left:(readerWidth-.9*o.imgViewerStyle.width)/2,top:(readerHeight-.9*o.imgViewerStyle.height)/2,width:.9*o.imgViewerStyle.width,height:.9*o.imgViewerStyle.height})},closeImgViewer:function(){var e=this;e.imgViewerSrc="",e.isShowImgViewer=!1},toggleUnseal:function(e){var o=this;o.closeAllLayer("isShowUnseal"),"close"==e?o.isShowUnseal=!1:(o.reGetImgVerifyCode(),o.isShowUnseal=!o.isShowUnseal)},reGetImgVerifyCode:function(){var e=this;e.unsealObj.imgCodeSrc=apiHost.user+"/CodeImage.aspx?equipmentId="+e.equipmentId+"&timeStamp="+(new Date).getTime()},submitUnseal:function(){var e=this;if(e.user&&10009!=e.user.userID)if(""!=e.unsealObj.imgCode)if(""!=e.unsealObj.password){var o="/reader/ReaderHandle.ashx?method=dynamicVerifyWithCode",t={userId:e.user.userID,pwd:e.unsealObj.password,yanzhengma:e.unsealObj.imgCode,equipmentId:e.equipmentId};$.post(o,t,function(o){1==o.result?(e.toggleUnseal("close"),window.location.reload()):alert(o.errMsg)},"json")}else alert("登录密码不能为空");else alert("问题答案不能为空")},confirmcallbackfun:function(e,o,t){var a=this;if("doconfirm"==e)if("gotobuy"==o)a.isWpsMiniprogram?a.gotoWpsBuy():window.open(a.buyLink);else if("gotobuyvip"==o)a.isWpsMiniprogram?a.gotoWpsBuy():window.open(a.buyVipLink);else if("reload"==o)window.location.reload();else if("close"==o)window.close();else if("deleteNote"==o){if(""!=t&&null!=t)t=JSON.parse(t);a._deleteNoteByServer(t)}else"deleteAllBookmark"==o?a._deleteAllBookmarkLocal():"gotologin"==o&&a.gotoLogin();else"docancel"==e&&("close"==o?window.close():a.isWpsMiniprogram&&"gotobuy"==o&&wpsGetUserVipInfo(function(e){dataCollect(e,"docer_tiku_click",{page_name:"preview_detail",page_position:"",module_name:"pay_box",module_position:"",element_name:"close",element_position:"",element_type:"button",event_time:getNowFullTime().fullDateTime,resource_id:a.bookId,resource_type:"book",file_type:"",pre_klm:preKlm})}))},getExtend:function(){var e=this,o="https://app.100xuexi.com/AD/Product.ashx?method=ShowAD",t={platNum:1,bookId:e.bookId};$.post(o,t,function(o){console.log(o);var t=[];if(o&&o.list&&o.list.length>0)for(var a=0;a<o.list.length;a++)for(var i=o.list[a],n=0;n<i.positionList.length;n++)if("AppEbookReader"==i.positionList[n]._Code){t.push(i);break}if(t.length>0){var r=parseInt(Math.random()*t.length,10);e.extendsAd=t[r],e.isShowExtendsAd=!0}else{var s="https://app.100xuexi.com/AD/A_AD.ashx?method=List",l={positionCode:"APPEbookTkReader",isValid:1};$.post(s,l,function(o){if(o&&o.list&&o.list.length>0&&(t=o.list),t.length>0){var a=parseInt(Math.random()*t.length,10);e.extendsAd=t[a],e.isShowExtendsAd=!0}},"json")}},"json")},closeExtend:function(){var e=this;null!=e.extendsAd&&(e.isShowExtendsAd=!1)},_creatMark:function(e){return creatMark(e)},goBack:function(){document.referrer?""!=document.referrer?document.referrer==window.location.href?window.location.replace("/"):window.history.go(-1):window.history.back(-1):window.location.replace("/")},gotoWpsBuy:function(){var e=this;e.$refs.scConfirm.hidden(),e.$nextTick(function(){e.$refs.scConfirm.show('<div class="com-popdialog-tips"><div class="offline-tips" style="text-align: justify;"><p>尊敬的用户：</p><p>&emsp;&emsp;您好！由于业务调整，自2025年3月24日起，您将无法下单购买【考研考证题库权益包】。如您在前述日期前已购买了【考研考证题库权益包】，且还在权益有效期内，您可继续使用您已购买的考研考证题库服务直至权益有效期届满之日。</p><p>&emsp;&emsp;自2026年3月31日起，【考研考证题库】服务将正式下线，届时您将无法进入本服务页面。</p><p>&emsp;&emsp;如您有任何疑问，您可以致电4006775005或者发送电子邮件至wps@wps.cn与我们联系。</p><p>&emsp;&emsp;感谢您对WPS的支持!</p><p style="text-align:right">2025年3月24日</p></div></div>',{popDialogTitle:"下线公告",cancelText:"知道了",confirmText:"",type:"alert",data:""})})},toggleAIChat:function(){var e=this;e.isShowAIChat=!e.isShowAIChat,localStorage.setItem("EBOOK_ISSHOW_AICHAT",e.isShowAIChat?1:0),e.isShowAIChat&&0==$("#iframeAiChat").length&&e.setAIChatUrl()},setAIChatUrl:function(){var e=this;if(e.chapId){$("#aiChatInner").html(aiChatLoaindingHtml);var o="https://scai.100xuexi.com/ajax/ProductAIHandle.ashx?method=GetCourseAiChatUrl";$.get(o,{userId:e.user.userID,bookId:e.bookId,plat:1,chapUid:e.chapId+".html",useraitoken:encodeURIComponent(userAIToken),isZxx:e.isZxxProduct?1:0},function(e){console.log("setAIChatUrl",e),e&&e.url?$("#aiChatInner").html('<iframe allow="camera; microphone" id="iframeAiChat" src="'+e.url+"&time="+(new Date).getTime()+'"></iframe>'):$("#aiChatInner").html(aiChatError)},"json")}},gotoLogin:function(){var e=this;e.agentName&&""!=e.agentName||e.scAgentApp&&""!=e.scAgentApp?window.location.replace(e.loginLink):window.location.replace("https://user.100xuexi.com/login.aspx?RetUrl="+encodeURIComponent("https://e.100xuexi.com/DigitalLibrary/ajax.aspx?action=GetCourseSSOLoginUrl&id="+(e.packageId?e.packageId:e.bookId)+"&readerType=h5"))},gotoBuyVip:function(){var e=this;e.agentName&&""!=e.agentName||e.scAgentApp&&e.scAgentApp,window.location.replace(e.buyVipLink)},gotoRechargeAiAccount:function(){var e=this;window.location.replace(e.rechargeAiAccountLink)}},mounted:function(){var e=this;if(e._setLink(),e._getReaderUIConfig(),e._getUserInfo(function(){if(e.userContactWay=e.user.mobile,e.isLibrary||10009==e.user.userID)e.readerContentBgStyle=null,e.readerContentBgCss="",e.bgText="";else{e.bgText=e.user.mobile;let o=e._creatMark(e.user.mobile);""!=o?(e.bgText="",e.readerContentBgStyle={backgroundImage:"url("+o+")"},e.readerContentBgCss="reader-content-bg-plus"):(e.readerContentBgStyle=null,e.readerContentBgCss="")}e._addUserTrack(),e._getEbookInfo(function(){e.isCanRead||e.isLibrary||e.isApiPartner||e.agentName||e.getExtend(),e._getEbookCatalog(function(){if(""!=chapId&&null!=chapId){for(var o=!1,t=0;t<e.ebook.catalog.length;t++)if(chapId==e.ebook.catalog[t].chapId){e.viewCatalog=e.ebook.catalog[t],e.currentCatalog=e.ebook.catalog[t],e._getChap(e.viewCatalog.chapEleId,e.viewCatalog.chapId,"down",function(){e.pId&&e.skipToPositon(e.pId)}),o=!0;break}o?(saveReadeRecordInterval&&clearInterval(saveReadeRecordInterval),saveReadeRecordInterval=setInterval(function(){console.log("saveReadeRecordInterval1"),e._setReadRecord()},5e3)):(e.toast("章节不存在"),e.viewCatalog=e.ebook.catalog[0],e.currentCatalog=e.ebook.catalog[0])}else e._getReadRecord(function(){e.readRecord&&e.checkIsCanRead(e.readRecord.chapEleId)?e._skipToReadRecord(function(){saveReadeRecordInterval&&clearInterval(saveReadeRecordInterval),saveReadeRecordInterval=setInterval(function(){console.log("saveReadeRecordInterval2"),e._setReadRecord()},5e3)}):(saveReadeRecordInterval&&clearInterval(saveReadeRecordInterval),saveReadeRecordInterval=setInterval(function(){console.log("saveReadeRecordInterval3"),e._setReadRecord()},5e3)),e.pId&&e.skipToPositon(e.pId)})}),e._getBookmarkList(),e.isShowAIChat&&!e.isWpsMiniprogram&&e.setAIChatUrl()})}),e.pageKeyup(),$(document).mouseup(function(o){var t=$("#textQuickMenu");t.is(o.target)||0!==t.has(o.target).length||(e.isShowTextMenu=!1,$("#readerContent .active").removeClass("active"))}),e.isWpsMiniprogram){var o=getNowFullTime();wpsGetUserVipInfo(function(t){dataCollect(t,"docer_tiku_display",{page_name:"preview_detail",page_position:"",module_name:"",module_position:"",element_name:"",element_position:"",element_type:"page",event_time:startLoadTimeObj.fullDateTime,resource_id:e.bookId,resource_type:"book",file_type:"",pre_klm:preKlm}),dataCollect(t,"docer_tiku_load",{page_name:"preview_detail",page_position:"",module_name:"",module_position:"",element_name:"",element_position:"",element_type:"page",event_time:o.fullDateTime,duration:o.ms-startLoadTimeObj.ms,resource_id:e.bookId,resource_type:"book",file_type:"",pre_klm:preKlm}),$(window).bind("beforeunload",function(){var o=getNowFullTime();dataCollect(t,"docer_tiku_stay",{page_name:"preview_detail",page_position:"",module_name:"",module_position:"",element_name:"",element_position:"",element_type:"page",event_time:o.fullDateTime,duration:o.ms-startLoadTimeObj.ms,resource_id:e.bookId,resource_type:"book",file_type:"",pre_klm:preKlm})})})}},created:function(){if(/android|ipad|iphone/i.test(navigator.userAgent))if(bookId){var e=window.location.search;0==e.indexOf("?")&&(e=e.substring(1)),window.location.replace("/m/reader/ebook/mReaderV2.aspx?"+e)}else alert("页面不存在"),window.location.href="/404.aspx"}});window.addEventListener("message",function(e){"https://scai.100xuexi.com"===e.origin&&("gotoLogin"===e.data.action?app.gotoLogin():"gotoBuyVip"===e.data.action?app.gotoBuyVip():"gotoRechargeAiAccount"===e.data.action&&app.gotoRechargeAiAccount())});